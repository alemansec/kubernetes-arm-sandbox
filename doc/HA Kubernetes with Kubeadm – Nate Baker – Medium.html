<!DOCTYPE html>
<html xmlns:cc="http://creativecommons.org/ns#"><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# medium-com: http://ogp.me/ns/fb/medium-com#"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=contain"><title>HA Kubernetes with Kubeadm – Nate Baker – Medium</title><link rel="canonical" href="https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198"><meta name="title" content="HA Kubernetes with Kubeadm – Nate Baker – Medium"><meta name="referrer" content="unsafe-url"><meta name="description" content="This post is geared towards users who are already using Kubeadm to deploy their Kubernetes clusters. If you’re not familiar with Kubeadm, check it out here…"><meta name="theme-color" content="#000000"><meta property="og:title" content="HA Kubernetes with Kubeadm – Nate Baker – Medium"><meta property="twitter:title" content="HA Kubernetes with Kubeadm – Nate Baker – Medium"><meta property="og:url" content="https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198"><meta property="og:image" content="https://cdn-images-1.medium.com/max/1200/1*7YItLT6IKYqNcVtDPeiyOQ.jpeg"><meta property="fb:app_id" content="542599432471018"><meta property="og:description" content="*Updated for 1.11*"><meta name="twitter:description" content="*Updated for 1.11*"><meta name="twitter:image:src" content="https://cdn-images-1.medium.com/max/1200/1*7YItLT6IKYqNcVtDPeiyOQ.jpeg"><link rel="publisher" href="https://plus.google.com/103654360130207659246"><link rel="author" href="https://medium.com/@bambash"><meta property="author" content="Nate Baker"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta property="article:publisher" content="https://www.facebook.com/medium"><meta property="article:author" content="https://medium.com/@bambash"><meta name="robots" content="index, follow"><meta property="article:published_time" content="2017-10-04T20:02:06.569Z"><meta name="twitter:site" content="@Medium"><meta property="og:site_name" content="Medium"><meta name="twitter:label1" value="Reading time"><meta name="twitter:data1" value="6 min read"><meta name="twitter:app:name:iphone" content="Medium"><meta name="twitter:app:id:iphone" content="828256236"><meta name="twitter:app:url:iphone" content="medium://p/b2133360b198"><meta property="al:ios:app_name" content="Medium"><meta property="al:ios:app_store_id" content="828256236"><meta property="al:android:package" content="com.medium.reader"><meta property="al:android:app_name" content="Medium"><meta property="al:ios:url" content="medium://p/b2133360b198"><meta property="al:android:url" content="medium://p/b2133360b198"><meta property="al:web:url" content="https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198"><link rel="search" type="application/opensearchdescription+xml" title="Medium" href="https://medium.com/osd.xml"><link rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/b2133360b198"><script type="application/ld+json">{"@context":"http://schema.org","@type":"NewsArticle","image":{"@type":"ImageObject","width":531,"height":651,"url":"https://cdn-images-1.medium.com/max/1062/1*7YItLT6IKYqNcVtDPeiyOQ.jpeg"},"url":"https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198","dateCreated":"2017-10-04T20:02:06.569Z","datePublished":"2017-10-04T20:02:06.569Z","dateModified":"2018-10-25T06:28:09.179Z","headline":"HA Kubernetes with Kubeadm","name":"HA Kubernetes with Kubeadm","thumbnailUrl":"https://cdn-images-1.medium.com/max/1062/1*7YItLT6IKYqNcVtDPeiyOQ.jpeg","keywords":["Tag:Kubernetes","Tag:Docker","Tag:Tech","Tag:Cloud Computing","Tag:Container Orchestration","LockedPostSource:0","Elevated:false","LayerCake:0"],"author":{"@type":"Person","name":"Nate Baker","url":"https://medium.com/@bambash"},"creator":["Nate Baker"],"publisher":{"@type":"Organization","name":"Medium","url":"https://medium.com/","logo":{"@type":"ImageObject","width":308,"height":60,"url":"https://cdn-images-1.medium.com/max/616/1*OMF3fSqH8t4xBJ9-6oZDZw.png"}},"mainEntityOfPage":"https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198"}</script><meta name="parsely-link" content="https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198"><link rel="stylesheet" type="text/css" class="js-glyph-" id="glyph-8" href="HA%20Kubernetes%20with%20Kubeadm%20%E2%80%93%20Nate%20Baker%20%E2%80%93%20Medium_files/m2.css"><link rel="stylesheet" href="HA%20Kubernetes%20with%20Kubeadm%20%E2%80%93%20Nate%20Baker%20%E2%80%93%20Medium_files/main-branding-base.css"><script>if (window.top !== window.self) window.top.location = window.self.location.href;var OB_startTime = new Date().getTime(); var OB_loadErrors = []; function _onerror(e) { OB_loadErrors.push(e) }; if (document.addEventListener) document.addEventListener("error", _onerror, true); else if (document.attachEvent) document.attachEvent("onerror", _onerror); function _asyncScript(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("script"); s.type = "text/javascript"; s.async = true; s.src = u; f.parentNode.insertBefore(s, f);}function _asyncStyles(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("link"); s.rel = "stylesheet"; s.href = u; f.parentNode.insertBefore(s, f); return s}(new Image()).src = "/_/stat?event=pixel.load&origin=" + encodeURIComponent(location.origin);</script><!--[if lt IE 9]><script charset="UTF-8" src="https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js"></script><![endif]--><link rel="icon" href="https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico" class="js-favicon"><link rel="apple-touch-icon" sizes="152x152" href="https://cdn-images-1.medium.com/fit/c/304/304/1*8I-HPL0bfoIzGied-dzOvA.png"><link rel="apple-touch-icon" sizes="120x120" href="https://cdn-images-1.medium.com/fit/c/240/240/1*8I-HPL0bfoIzGied-dzOvA.png"><link rel="apple-touch-icon" sizes="76x76" href="https://cdn-images-1.medium.com/fit/c/152/152/1*8I-HPL0bfoIzGied-dzOvA.png"><link rel="apple-touch-icon" sizes="60x60" href="https://cdn-images-1.medium.com/fit/c/120/120/1*8I-HPL0bfoIzGied-dzOvA.png"><link rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg" color="#171717"></head><body itemscope="" class=" postShowScreen browser-firefox is-withMagicUnderlines v-glyph v-glyph--m2 is-noJs"><script>document.body.className = document.body.className.replace(/(^|\s)is-noJs(\s|$)/, "$1is-js$2")</script><div class="site-main" id="container"><div class="butterBar butterBar--error"></div><div class="surface"><div id="prerendered" class="screenContent"><canvas class="canvas-renderer"></canvas><div class="container u-maxWidth740 u-xs-margin0 notesPositionContainer js-notesPositionContainer"></div><div class="metabar u-clearfix js-metabar u-boxShadow4px12pxBlackLightest u-fixed u-backgroundTransparentWhiteDarkest u-xs-sizeFullViewportWidth"><div class="branch-journeys-top"></div><div class="js-metabarMiddle metabar-inner u-marginAuto u-maxWidth1032 u-flexCenter u-justifyContentSpaceBetween u-height65 u-xs-height56 u-paddingHorizontal20"><div class="metabar-block u-flex1 u-flexCenter"><div class="u-xs-hide js-metabarLogoLeft"><a href="https://medium.com/" data-log-event="home" class="siteNav-logo u-fillTransparentBlackDarker u-flex0 u-flexCenter u-paddingTop0"><span class="svgIcon svgIcon--logoMonogram svgIcon--45px is-flushLeft u-flex0 u-flexCenter u-paddingTop0"><svg class="svgIcon-use" width="45" height="45"><path d="M5 40V5h35v35H5zm8.56-12.627c0 .555-.027.687-.318 1.03l-2.457 2.985v.396h6.974v-.396l-2.456-2.985c-.291-.343-.344-.502-.344-1.03V18.42l6.127 13.364h.714l5.256-13.364v10.644c0 .29 0 .342-.185.528l-1.848 1.796v.396h9.19v-.396l-1.822-1.796c-.184-.186-.21-.238-.21-.528V15.937c0-.291.026-.344.21-.528l1.823-1.797v-.396h-6.471l-4.622 11.542-5.203-11.542h-6.79v.396l2.14 2.64c.239.292.291.37.291.768v10.353z"></path></svg></span><span class="u-textScreenReader">Homepage</span></a></div><div class="u-xs-show js-metabarLogoLeft"><a href="https://medium.com/" data-log-event="home" class="siteNav-logo u-fillTransparentBlackDarker u-flex0 u-flexCenter u-paddingTop0"><span class="svgIcon svgIcon--logoMonogram svgIcon--45px is-flushLeft u-flex0 u-flexCenter u-paddingTop0"><svg class="svgIcon-use" width="45" height="45"><path d="M5 40V5h35v35H5zm8.56-12.627c0 .555-.027.687-.318 1.03l-2.457 2.985v.396h6.974v-.396l-2.456-2.985c-.291-.343-.344-.502-.344-1.03V18.42l6.127 13.364h.714l5.256-13.364v10.644c0 .29 0 .342-.185.528l-1.848 1.796v.396h9.19v-.396l-1.822-1.796c-.184-.186-.21-.238-.21-.528V15.937c0-.291.026-.344.21-.528l1.823-1.797v-.396h-6.471l-4.622 11.542-5.203-11.542h-6.79v.396l2.14 2.64c.239.292.291.37.291.768v10.353z"></path></svg></span><span class="u-textScreenReader">Homepage</span></a></div></div><div class="metabar-block u-flex0"><div class="buttonSet buttonSet--wide"><a class="button button--chromeless u-baseColor--buttonNormal u-xs-hide js-upgradeMembershipAction" href="https://medium.com/membership?source=upgrade_membership---nav_full">Become a member</a><a class="button button--primary button--chromeless u-accentColor--buttonNormal is-inSiteNavBar u-xs-hide js-signInButton" href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%2F%40bambash%2Fha-kubernetes-cluster-via-kubeadm-b2133360b198&amp;source=--------------------------nav_reg&amp;operation=login" data-action="sign-in-prompt" data-redirect="https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198" data-action-source="--------------------------nav_reg">Sign in</a><a class="button button--primary button--withChrome u-accentColor--buttonNormal is-inSiteNavBar js-signUpButton" href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%2F%40bambash%2Fha-kubernetes-cluster-via-kubeadm-b2133360b198&amp;source=--------------------------nav_reg&amp;operation=register" data-action="sign-up-prompt" data-redirect="https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198" data-action-source="--------------------------nav_reg">Get started</a></div></div></div></div><div class="metabar metabar--spacer js-metabarSpacer u-height65 u-xs-height56"></div><main role="main"><article class=" u-minHeight100vhOffset65 u-overflowHidden postArticle postArticle--full u-marginBottom40" lang="en"><div class="postArticle-content js-postField js-notesSource js-trackPostScrolls" data-post-id="b2133360b198" data-source="post_page" data-tracking-context="postPage"><section name="8b1f" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h1 name="2695" id="2695" class="graf graf--h3 graf--leading graf--title">HA Kubernetes with&nbsp;Kubeadm</h1><div class="uiScale uiScale-ui--regular uiScale-caption--regular u-flexCenter u-marginVertical24 u-fontSize15 js-postMetaLockup"><div class="u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@bambash?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="ec8d7b9beff6" data-action-type="hover" data-user-id="ec8d7b9beff6" dir="auto"><img src="HA%20Kubernetes%20with%20Kubeadm%20%E2%80%93%20Nate%20Baker%20%E2%80%93%20Medium_files/1Oc72p_7gBI5lqVHFe3iPMw_003.jpeg" class="avatar-image u-size50x50" alt="Go to the profile of Nate Baker"></a></div><div class="u-flex1 u-paddingLeft15 u-overflowHidden"><div class="u-paddingBottom3"><a class="ds-link ds-link--styleSubtle ui-captionStrong u-inlineBlock link link--darken link--darker" href="https://medium.com/@bambash" data-action="show-user-card" data-action-value="ec8d7b9beff6" data-action-type="hover" data-user-id="ec8d7b9beff6" dir="auto">Nate Baker</a><span class="followState js-followState" data-user-id="ec8d7b9beff6"><button class="button button--smallest u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton u-marginLeft10 u-xs-hide" data-action="sign-up-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-redirect="https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198" data-action-source="post_header_lockup"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--smallest button--dark u-noUserSelect button--withChrome u-accentColor--buttonDark button--follow js-followButton u-marginLeft10 u-xs-hide" data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/ec8d7b9beff6" data-action-source="post_header_lockup-ec8d7b9beff6-------------------------follow_byline"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="ui-caption postMetaInline js-testPostMetaInlineSupplemental"><time datetime="2017-10-04T20:02:06.569Z">Oct 4, 2017</time><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="6 min read"></span></div></div></div><p name="e08d" id="e08d" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">*Updated for 1.11*</strong></p><p name="a660" id="a660" class="graf graf--p graf-after--p">This
 post is geared towards users who are already using Kubeadm to deploy 
their Kubernetes clusters. If you’re not familiar with Kubeadm, check it
 out here: <a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/" data-href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/" class="markup--anchor markup--p-anchor" rel="nofollow noopener noopener noopener nofollow noopener" target="_blank">https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/</a></p><p name="e045" id="e045" class="graf graf--p graf-after--p">If you’ve referenced this post in the past for 1.7–1.10, a lot has changed with 1.11 and 1.12.</p><p name="a0ba" id="a0ba" class="graf graf--p graf-after--p">An HA guide has been added to the official Kubernetes documentation: <a href="https://kubernetes.io/docs/setup/independent/high-availability/" data-href="https://kubernetes.io/docs/setup/independent/high-availability/" class="markup--anchor markup--p-anchor" rel="nofollow noopener noopener nofollow noopener" target="_blank">https://kubernetes.io/docs/setup/independent/high-availability/</a></p><h3 name="f7ac" id="f7ac" class="graf graf--h3 graf-after--p">Background</h3><p name="d465" id="d465" class="graf graf--p graf-after--h3">I’m
 creating this in hopes that it helps people with their Kubernetes 
journey. When first starting out, I followed the very popular 
“Kubernetes The Hardway”guide: <a href="https://github.com/kelseyhightower/kubernetes-the-hard-way" data-href="https://github.com/kelseyhightower/kubernetes-the-hard-way" class="markup--anchor markup--p-anchor" rel="nofollow noopener noopener noopener noopener noopener noopener noopener nofollow noopener" target="_blank">https://github.com/kelseyhightower/kubernetes-the-hard-way</a>.
 It’s a great starting point for those who want to understand the ins 
and outs of how Kubernetes operates. While its good to know how all of 
the Kubernetes pieces connect, it can be time consuming.</p><h3 name="d59e" id="d59e" class="graf graf--h3 graf-after--p">Kubeadm</h3><p name="8b46" id="8b46" class="graf graf--p graf-after--h3"><a href="https://kubernetes.io/docs/setup/independent/install-kubeadm/" data-href="https://kubernetes.io/docs/setup/independent/install-kubeadm/" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">Kubeadm</a>
 is great for standing up a k8s cluster. However it does not support 
multi-master deployments. It’s something that is being actively worked 
on, but for now you have to handle high availability on your own. That 
said, by using <a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-alpha/" data-href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-alpha/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">kubeadm phases</a>, you are able to configure a highly available cluster in a few steps.</p><h3 name="8239" id="8239" class="graf graf--h3 graf-after--p">Creating a multi-master cluster</h3><p name="571b" id="571b" class="graf graf--p graf-after--h3">A
 few servers, a load balancer, and kubeadm are the only tools needed to 
set this up. It’s configured using the load balancer for node (kubelet),
 and kubectl communication. You could achieve this setup on a hosting 
provider, or on prem by leveraging HAproxy. You’ll just need something 
to load balance traffic for the master nodes. Setup each master node 
using port&nbsp;:6443 as a backend for your load balancer of choice.</p><p name="c7ab" id="c7ab" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Let’s assume the following:</strong></p><pre name="9792" id="9792" class="graf graf--pre graf-after--p">etcd   1 address      = 10.0.0.6<br>etcd   2 address      = 10.0.0.7<br>etcd   3 address      = 10.0.0.8</pre><pre name="00dc" id="00dc" class="graf graf--pre graf-after--pre">master 1 address      = 10.0.0.50<br>master 2 address      = 10.0.0.51<br>master 3 address      = 10.0.0.52</pre><pre name="4703" id="4703" class="graf graf--pre graf-after--pre">load balancer address = 10.0.0.200</pre><figure name="898f" id="898f" class="graf graf--figure graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 531px; max-height: 651px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 122.6%;"></div><div class="progressiveMedia js-progressiveMedia graf-image" data-image-id="1*7YItLT6IKYqNcVtDPeiyOQ.jpeg" data-width="531" data-height="651"><img src="HA%20Kubernetes%20with%20Kubeadm%20%E2%80%93%20Nate%20Baker%20%E2%80%93%20Medium_files/17YItLT6IKYqNcVtDPeiyOQ_002.jpeg" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/1600/1*7YItLT6IKYqNcVtDPeiyOQ.jpeg"><span><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="HA%20Kubernetes%20with%20Kubeadm%20%E2%80%93%20Nate%20Baker%20%E2%80%93%20Medium_files/17YItLT6IKYqNcVtDPeiyOQ.jpeg"></span></div></div></figure><h4 name="1109" id="1109" class="graf graf--h4 graf-after--figure">Step 1 — Deploy your&nbsp;servers</h4><p name="4c08" id="4c08" class="graf graf--p graf-after--h4">Before beginning, make sure your servers have been deployed with the <a href="https://kubernetes.io/docs/setup/independent/install-kubeadm/#before-you-begin" data-href="https://kubernetes.io/docs/setup/independent/install-kubeadm/#before-you-begin" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">necessary prerequisites</a>.</p><h4 name="8672" id="8672" class="graf graf--h4 graf-after--p">Step 2 — Setup&nbsp;etcd</h4><p name="7c0b" id="7c0b" class="graf graf--p graf-after--h4"><em class="markup--em markup--p-em">Skip this step if an etcd cluster is already available.</em></p><p name="bbd6" id="bbd6" class="graf graf--p graf-after--p">There are a few different ways to deploy etcd. This article assumes you’ve followed the <a href="https://kubernetes.io/docs/setup/independent/setup-ha-etcd-with-kubeadm/" data-href="https://kubernetes.io/docs/setup/independent/setup-ha-etcd-with-kubeadm/" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">kubeadm documentation</a>.
 If so, the etcd nodes will use the kubelet, docker, and a static kube 
manifest to form their quorum. If you already have a cluster, make the 
necessary adjustments to the config in the following steps.</p><p name="8225" id="8225" class="graf graf--p graf-after--p">The CA created for etcd will be used later when provisioning the master nodes.</p><h4 name="5bb4" id="5bb4" class="graf graf--h4 graf-after--p">Step 3 — Kubeadm config for&nbsp;masters</h4><p name="dcd8" id="dcd8" class="graf graf--p graf-after--h4">The
 kubeadm config allows for customization of the certificates and 
manifests that are needed when deploying Kubernetes. It should include 
information about the api endpoints, etcd endpoints/certs, the bootstrap
 token, and what hostnames/ip addresses should be included in the 
certificates.</p><p name="62ff" id="62ff" class="graf graf--p graf-after--p">Before you setup the config, generate a <a href="https://kubernetes.io/docs/admin/kubeadm/#manage-tokens" data-href="https://kubernetes.io/docs/admin/kubeadm/#manage-tokens" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">token</a>.</p><p name="b498" id="b498" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">kubeadm token generate</code></p><p name="926e" id="926e" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Example kubeadm config file:</strong></p><pre name="76f4" id="76f4" class="graf graf--pre graf-after--p">apiVersion: kubeadm.k8s.io/v1alpha2<br>kind: MasterConfiguration<br>kubernetesVersion: v1.11.3<br>api:<br>  controlPlaneEndpoint: "10.0.0.200:6443"<br>etcd:<br>  external:<br>    endpoints:<br>    - <a href="https://10.10.0.11:2379/" data-href="https://10.10.0.11:2379" class="markup--anchor markup--pre-anchor" rel="nofollow noopener nofollow noopener" target="_blank">https://10.0.0.6:2379</a><br>    - <a href="https://10.10.2.11:2379/" data-href="https://10.10.2.11:2379" class="markup--anchor markup--pre-anchor" rel="nofollow noopener nofollow noopener" target="_blank">https://10.0.0.7:2379</a><br>    - <a href="https://10.10.4.11:2379/" data-href="https://10.10.4.11:2379" class="markup--anchor markup--pre-anchor" rel="nofollow noopener nofollow noopener" target="_blank">https://10.0.0.8:2379</a><br>    caFile: /etc/kubernetes/pki/etcd/ca.crt<br>    certFile: /etc/kubernetes/pki/apiserver-etcd-client.crt<br>    keyFile: /etc/kubernetes/pki/apiserver-etcd-client.key<br>apiServerExtraArgs:<br>  apiserver-count: "3"<br>apiServerCertSANs:<br>- kubernetes.default<br>- kubernetes.default.svc.cluster.local<br>- 10.0.0.200<br>- 10.0.0.50<br>- 10.0.0.51<br>- 10.0.0.52<br>- master-01-hostname<br>- master-02-hostname<br>- master-03-hostname<br>bootstrapTokens:<br>- groups:<br>  - system:bootstrappers:kubeadm:default-node-token<br>  token: &lt;your token from the step above&gt;<br>  ttl: '0'<br>  usages:<br>  - signing<br>  - authentication</pre><p name="1112" id="1112" class="graf graf--p graf-after--pre">The
 etcd certs should have been generated during the etcd cluster setup. Be
 sure to include the additional SANs for yourAPI Server certificate. It 
needs to include all master addresses <em class="markup--em markup--p-em">AND </em>the
 load balancer address! Also, take note of the kubeadm api version. The 
config file may need to change depending on the version of kubeadm and 
Kubernetes. Save this file as <code class="markup--code markup--p-code">kubeadmcfg.yaml</code></p><h4 name="6d60" id="6d60" class="graf graf--h4 graf-after--p">Step 4 — Distribute the etcd apiserver client certificates</h4><p name="0bab" id="0bab" class="graf graf--p graf-after--h4">Before
 distributing the kubeadm config to the master nodes, you must first 
distribute the etcd certificates. Without them, the kube apiserver will 
not be able to communicate securely with etcd. Be sure the following 
files exist on the master nodes:</p><pre name="7bfc" id="7bfc" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">/etc/kubernetes/pki<br>├── apiserver-etcd-client.crt<br>├── apiserver-etcd-client.key<br>└── etcd<br>    └── ca.crt</code></pre><p name="e8e9" id="e8e9" class="graf graf--p graf-after--pre">They were generated during etcd bootstraping via<code class="markup--code markup--p-code">kubeadm alpha phase certs apiserver-etcd-client --config=/path/to/etcd/kubeadmcfg.yaml</code></p><h4 name="9175" id="9175" class="graf graf--h4 graf-after--p">Step 5 — Distribute the kubeadmcfg.yaml</h4><p name="3d01" id="3d01" class="graf graf--p graf-after--h4">Once
 the etcd certs are in place, the config should be distributed to each 
master. The file can be placed anywhere, but this article will assume it
 exists at <code class="markup--code markup--p-code">/tmp/kubeadmcfg.yaml</code>.</p><h4 name="7f52" id="7f52" class="graf graf--h4 graf-after--p">Step 6 — Generate the master&nbsp;CA</h4><p name="6c0f" id="6c0f" class="graf graf--p graf-after--h4">Before running <code class="markup--code markup--p-code">kubeadm init</code>,
 we need to generate the master certificate authority. It will be used 
to create and sign the certs and keys for the master nodes. <strong class="markup--strong markup--p-strong">This only needs to be done once! The CA will be reused on the other master nodes.</strong></p><p name="d7e5" id="d7e5" class="graf graf--p graf-after--p">On the first master node, run the following:</p><pre name="a9a0" id="a9a0" class="graf graf--pre graf-after--p">kubeadm alpha phase certs ca --config=/tmp/kubeadmcfg.yaml<br>kubeadm alpha phase certs front-proxy-ca --config=/tmp/kubeadmcfg.yaml<br>kubeadm alpha phase certs sa --config=/tmp/kubeadmcfg.yaml</pre><p name="28f1" id="28f1" class="graf graf--p graf-after--pre">The directory tree should look something like this:</p><pre name="98da" id="98da" class="graf graf--pre graf-after--p">/etc/kubernetes<br>├── pki<br>│   ├── apiserver-etcd-client.crt<br>│   ├── apiserver-etcd-client.key<br>│   ├── ca.crt<br>│   ├── ca.key<br>│   ├── etcd<br>│   │   ├── ca.crt<br>│   ├── front-proxy-ca.crt<br>│   ├── front-proxy-ca.key<br>│   ├── front-proxy-client.crt<br>│   ├── front-proxy-client.key<br>│   ├── sa.key<br>│   └── sa.pub<br>└── scheduler.conf</pre><h4 name="2df5" id="2df5" class="graf graf--h4 graf-after--pre">Step 7 — Distribute the master&nbsp;PKI</h4><p name="adff" id="adff" class="graf graf--p graf-after--h4">If the CA was created successfully, you should have a directory with all of the kubelet certs and keys in <code class="markup--code markup--p-code">/etc/kubernetes/pki</code>. This directory will need to be distributed to the other 2 master instances. Sync the <code class="markup--code markup--p-code">pki</code> directory to <code class="markup--code markup--p-code">/etc/kubernetes</code> on the other masters.</p><h4 name="e4cd" id="e4cd" class="graf graf--h4 graf-after--p">Step 8 — Initialize the master control&nbsp;plane</h4><p name="5210" id="5210" class="graf graf--p graf-after--h4">When
 all PKI certs/keys are in place and etcd is running, the master nodes 
can be initialized. On each master, run the following:</p><pre name="2087" id="2087" class="graf graf--pre graf-after--p">kubeadm init --config /tmp/kubeadmcfg.yaml</pre><p name="1b3a" id="1b3a" class="graf graf--p graf-after--pre">On a successful initialization, you’ll have a 3 master nodes that are ready to roll. The <code class="markup--code markup--p-code">/etc/kubernetes</code> directory should look like this:</p><pre name="d98f" id="d98f" class="graf graf--pre graf-after--p">/etc/kubernetes<br>├── admin.conf<br>├── controller-manager.conf<br>├── kubelet.conf<br>├── manifests<br>│   ├── kube-apiserver.yaml<br>│   ├── kube-controller-manager.yaml<br>│   └── kube-scheduler.yaml<br>├── pki<br>│   ├── apiserver.crt<br>│   ├── apiserver-etcd-client.crt<br>│   ├── apiserver-etcd-client.key<br>│   ├── apiserver.key<br>│   ├── apiserver-kubelet-client.crt<br>│   ├── apiserver-kubelet-client.key<br>│   ├── ca.crt<br>│   ├── ca.key<br>│   ├── etcd<br>│   │   ├── ca.crt<br>│   ├── front-proxy-ca.crt<br>│   ├── front-proxy-ca.key<br>│   ├── front-proxy-client.crt<br>│   ├── front-proxy-client.key<br>│   ├── sa.key<br>│   └── sa.pub<br>└── scheduler.conf</pre><p name="2d12" id="2d12" class="graf graf--p graf-after--pre">Double
 check the manifests to be sure the kubeadm config was properly read. 
You should see your external etcd information in the <code class="markup--code markup--p-code">kube-apiserver.yaml</code> manifest.</p><p name="f90c" id="f90c" class="graf graf--p graf-after--p">Take note of the <code class="markup--code markup--p-code">join</code> that is output during initialization. It’s needed when adding worker nodes.</p><pre name="1328" id="1328" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">kubeadm join --token &lt;YOUR_KUBE_TOKEN&gt; 10.0.0.50:6443 --discovery-token-ca-cert-hash sha256:89870e4215b92262c5093b3f4f6d57be8580c3442ed6c8b00b0b30822c41e5b3</code></pre><h4 name="4060" id="4060" class="graf graf--h4 graf-after--pre">Step 9 — Setup&nbsp;kubectl</h4><p name="ddbf" id="ddbf" class="graf graf--p graf-after--h4">If
 the above steps are complete, and your load balancer is setup to handle
 the masters, then you should have a highly available master setup! 
Alright!</p><p name="2b74" id="2b74" class="graf graf--p graf-after--p">Verify the cluster is working by setting up <code class="markup--code markup--p-code">kubectl</code> to communicate with the load balancer.</p><p name="978e" id="978e" class="graf graf--p graf-after--p">Setup <code class="markup--code markup--p-code">kubectl</code> like you would normally by copying <code class="markup--code markup--p-code">/etc/kubernetes/admin.conf</code> into <code class="markup--code markup--p-code">~/.kube/config</code></p><p name="270d" id="270d" class="graf graf--p graf-after--p">Edit <code class="markup--code markup--p-code">~/.kube/config</code> and change <code class="markup--code markup--p-code">server: 10.0.0.50</code> to <code class="markup--code markup--p-code">server: 10.0.0.200</code></p><p name="3b0b" id="3b0b" class="graf graf--p graf-after--p">Run <code class="markup--code markup--p-code">kubectl get nodes</code> and you should see output similar to:</p><pre name="e49f" id="e49f" class="graf graf--pre graf-after--p">NAME         STATUS    ROLES     AGE       VERSION<br>10.0.0.50    Ready     master    1h        v1.11.3<br>10.0.0.51    Ready     master    1h        v1.11.3<br>10.0.0.52    Ready     master    1h        v1.11.3</pre><p name="9d18" id="9d18" class="graf graf--p graf-after--pre">Don’t forget to <a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#pod-network" data-href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#pod-network" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">apply the network overlay</a>, otherwise the Status will display “NotReady”. <em class="markup--em markup--p-em">(I use </em><a href="https://github.com/weaveworks/weave" data-href="https://github.com/weaveworks/weave" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank"><em class="markup--em markup--p-em">weave</em></a><em class="markup--em markup--p-em">)</em></p><h4 name="b7e5" id="b7e5" class="graf graf--h4 graf-after--p">Step 10 — Join nodes to the&nbsp;cluster</h4><p name="0aff" id="0aff" class="graf graf--p graf-after--h4">Now that you have a functional master cluster, join some worker nodes!</p><p name="af4c" id="af4c" class="graf graf--p graf-after--p">On any of your workers, run:</p><pre name="8504" id="8504" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">kubeadm join --token YOUR_CLUSTER_TOKEN 10.0.0.200:6443 --discovery-token-ca-cert-hash sha256:89870e4215b92262c5093b3f4f6d57be8580c3442ed6c8b00b0b30822c41e5b3</code></pre><p name="c064" id="c064" class="graf graf--p graf-after--pre">And
 that’s it! If everything was setup cleanly, you should now have a 
highly available cluster. Start joining workers, and take over the 
world!</p><h3 name="2d96" id="2d96" class="graf graf--h3 graf-after--p">Closing Thoughts</h3><p name="f7fa" id="f7fa" class="graf graf--p graf-after--h3">Using
 the kubeadm config file is still in alpha, things will change as 
kubeadm matures. If you’re running on a cloud provider, like AWS, you 
can add those things into the config file. Almost anything you can 
include in static manifests can be added to the kubeadm config. It’s 
possible to automate all of this, it just takes a little TLC.</p><p name="c413" id="c413" class="graf graf--p graf-after--p">Hopefully the process of distributing PKI and leveraging a load balancer becomes more streamlined.</p><p name="4620" id="4620" class="graf graf--p graf-after--p">This
 is just one way to achieve HA with kubeadm. I probably missed a few 
things, so please feel free to make adjustments and leave suggestions in
 the comments!</p><p name="69de" id="69de" class="graf graf--p graf-after--p">Thanks!</p><p name="5d92" id="5d92" class="graf graf--p graf-after--p graf--trailing">Nate</p></div></div></section></div><footer class="u-paddingTop10"><div class="container u-maxWidth740"><div class="row"><div class="col u-size12of12"></div></div><div class="row"><div class="col u-size12of12 js-postTags"><div class="u-paddingBottom10"><ul class="tags tags--postTags tags--borderless"><li><a class="link u-baseColor--link" href="https://medium.com/tag/kubernetes?source=post" data-action-source="post">Kubernetes</a></li><li><a class="link u-baseColor--link" href="https://medium.com/tag/docker?source=post" data-action-source="post">Docker</a></li><li><a class="link u-baseColor--link" href="https://medium.com/tag/tech?source=post" data-action-source="post">Tech</a></li><li><a class="link u-baseColor--link" href="https://medium.com/tag/cloud-computing?source=post" data-action-source="post">Cloud Computing</a></li><li><a class="link u-baseColor--link" href="https://medium.com/tag/container-orchestration?source=post" data-action-source="post">Container Orchestration</a></li></ul></div></div></div><div class="postActions js-postActionsFooter "><div class="u-flexCenter"><div class="u-flex1"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="b2133360b198" data-is-icon-29px="true" data-is-circle="true" data-has-recommend-list="true" data-source="post_actions_footer-----b2133360b198---------------------clap_footer" data-clap-string-singular="clap" data-clap-string-plural="claps"><div class="u-relative u-foreground"><button class="button button--large button--circle button--withChrome u-baseColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton clapButton--darker clapButton--largePill u-relative u-foreground u-xs-paddingLeft13 u-width60 u-height60 u-accentColor--textNormal u-accentColor--buttonNormal clap-onboarding" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/b2133360b198" data-action-source="post_actions_footer-----b2133360b198---------------------clap_footer" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33"><path d="M28.86 17.342l-3.64-6.402c-.292-.433-.712-.729-1.163-.8a1.124 1.124 0 0 0-.889.213c-.63.488-.742 1.181-.33 2.061l1.222 2.587 1.4 2.46c2.234 4.085 1.511 8.007-2.145 11.663-.26.26-.526.49-.797.707 1.42-.084 2.881-.683 4.292-2.094 3.822-3.823 3.565-7.876 2.05-10.395zm-6.252 11.075c3.352-3.35 3.998-6.775 1.978-10.469l-3.378-5.945c-.292-.432-.712-.728-1.163-.8a1.122 1.122 0 0 0-.89.213c-.63.49-.742 1.182-.33 2.061l1.72 3.638a.502.502 0 0 1-.806.568l-8.91-8.91a1.335 1.335 0 0 0-1.887 1.886l5.292 5.292a.5.5 0 0 1-.707.707l-5.292-5.292-1.492-1.492c-.503-.503-1.382-.505-1.887 0a1.337 1.337 0 0 0 0 1.886l1.493 1.492 5.292 5.292a.499.499 0 0 1-.353.854.5.5 0 0 1-.354-.147L5.642 13.96a1.338 1.338 0 0 0-1.887 0 1.338 1.338 0 0 0 0 1.887l2.23 2.228 3.322 3.324a.499.499 0 0 1-.353.853.502.502 0 0 1-.354-.146l-3.323-3.324a1.333 1.333 0 0 0-1.886 0 1.325 1.325 0 0 0-.39.943c0 .356.138.691.39.943l6.396 6.397c3.528 3.53 8.86 5.313 12.821 1.353zM12.73 9.26l5.68 5.68-.49-1.037c-.518-1.107-.426-2.13.224-2.89l-3.303-3.304a1.337 1.337 0 0 0-1.886 0 1.326 1.326 0 0 0-.39.944c0 .217.067.42.165.607zm14.787 19.184c-1.599 1.6-3.417 2.392-5.353 2.392-.349 0-.7-.03-1.058-.082a7.922 7.922 0 0 1-3.667.887c-3.049 0-6.115-1.626-8.359-3.87l-6.396-6.397A2.315 2.315 0 0 1 2 19.724a2.327 2.327 0 0 1 1.923-2.296l-.875-.875a2.339 2.339 0 0 1 0-3.3 2.33 2.33 0 0 1 1.24-.647l-.139-.139c-.91-.91-.91-2.39 0-3.3.884-.884 2.421-.882 3.301 0l.138.14a2.335 2.335 0 0 1 3.948-1.24l.093.092c.091-.423.291-.828.62-1.157a2.336 2.336 0 0 1 3.3 0l3.384 3.386a2.167 2.167 0 0 1 1.271-.173c.534.086 1.03.354 1.441.765.11-.549.415-1.034.911-1.418a2.12 2.12 0 0 1 1.661-.41c.727.117 1.385.565 1.853 1.262l3.652 6.423c1.704 2.832 2.025 7.377-2.205 11.607zM13.217.484l-1.917.882 2.37 2.837-.454-3.719zm8.487.877l-1.928-.86-.44 3.697 2.368-2.837zM16.5 3.293L15.478-.005h2.044L16.5 3.293z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33"><g fill-rule="evenodd"><path d="M29.58 17.1l-3.854-6.78c-.365-.543-.876-.899-1.431-.989a1.491 1.491 0 0 0-1.16.281c-.42.327-.65.736-.7 1.207v.001l3.623 6.367c2.46 4.498 1.67 8.802-2.333 12.807-.265.265-.536.505-.81.728 1.973-.222 3.474-1.286 4.45-2.263 4.166-4.165 3.875-8.6 2.215-11.36zm-4.831.82l-3.581-6.3c-.296-.439-.725-.742-1.183-.815a1.105 1.105 0 0 0-.89.213c-.647.502-.755 1.188-.33 2.098l1.825 3.858a.601.601 0 0 1-.197.747.596.596 0 0 1-.77-.067L10.178 8.21c-.508-.506-1.393-.506-1.901 0a1.335 1.335 0 0 0-.393.95c0 .36.139.698.393.95v.001l5.61 5.61a.599.599 0 1 1-.848.847l-5.606-5.606c-.001 0-.002 0-.003-.002L5.848 9.375a1.349 1.349 0 0 0-1.902 0 1.348 1.348 0 0 0 0 1.901l1.582 1.582 5.61 5.61a.6.6 0 0 1-.848.848l-5.61-5.61c-.51-.508-1.393-.508-1.9 0a1.332 1.332 0 0 0-.394.95c0 .36.139.697.393.952l2.363 2.362c.002.001.002.002.002.003l3.52 3.52a.6.6 0 0 1-.848.847l-3.522-3.523h-.001a1.336 1.336 0 0 0-.95-.393 1.345 1.345 0 0 0-.949 2.295l6.779 6.78c3.715 3.713 9.327 5.598 13.49 1.434 3.527-3.528 4.21-7.13 2.086-11.015zM11.817 7.727c.06-.328.213-.64.466-.893.64-.64 1.755-.64 2.396 0l3.232 3.232c-.82.783-1.09 1.833-.764 2.992l-5.33-5.33z"></path><path d="M13.285.48l-1.916.881 2.37 2.837z"></path><path d="M21.719 1.361L19.79.501l-.44 3.697z"></path><path d="M16.502 3.298L15.481 0h2.043z"></path></g></svg></span></span></button><div class="clapUndo u-width60 u-round u-height32 u-absolute u-borderBox u-paddingRight5 u-transition--transform200Springu-backgroundGrayLighter js-clapUndo" style="top: 14px; padding: 2px;"><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon u-floatRight" data-action="multivote-undo" data-action-value="b2133360b198"><span class="svgIcon svgIcon--removeThin svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M20.13 8.11l-5.61 5.61-5.609-5.61-.801.801 5.61 5.61-5.61 5.61.801.8 5.61-5.609 5.61 5.61.8-.801-5.609-5.61 5.61-5.61" fill-rule="evenodd"></path></svg></span></button></div></div><span class="u-relative u-background js-actionMultirecommendCount u-marginLeft16"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton u-textColorDarker" data-action="show-recommends" data-action-value="b2133360b198">232 claps</button><span class="u-xs-hide"></span></span></div></div><div class="buttonSet u-flex0"><a class="button button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon button--dark button--chromeless u-xs-hide u-marginRight12" href="https://medium.com/p/b2133360b198/share/twitter" title="Share on Twitter" aria-label="Share on Twitter" target="_blank" data-action-source="post_actions_footer"><span class="button-defaultState"><span class="svgIcon svgIcon--twitterFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M22.053 7.54a4.474 4.474 0 0 0-3.31-1.455 4.526 4.526 0 0 0-4.526 4.524c0 .35.04.7.082 1.05a12.9 12.9 0 0 1-9.3-4.77c-.39.69-.61 1.46-.65 2.26.03 1.6.83 2.99 2.02 3.79-.72-.02-1.41-.22-2.02-.57-.01.02-.01.04 0 .08-.01 2.17 1.55 4 3.63 4.44-.39.08-.79.13-1.21.16-.28-.03-.57-.05-.81-.08.54 1.77 2.21 3.08 4.2 3.15a9.564 9.564 0 0 1-5.66 1.94c-.34-.03-.7-.06-1.05-.08 2 1.27 4.38 2.02 6.94 2.02 8.31 0 12.86-6.9 12.84-12.85.02-.24.01-.43 0-.65.89-.62 1.65-1.42 2.26-2.34-.82.38-1.69.62-2.59.72a4.37 4.37 0 0 0 1.94-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></span></span></a><a class="button button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon button--dark button--chromeless u-xs-hide u-marginRight12" href="https://medium.com/p/b2133360b198/share/facebook" title="Share on Facebook" aria-label="Share on Facebook" target="_blank" data-action-source="post_actions_footer"><span class="button-defaultState"><span class="svgIcon svgIcon--facebookSquare svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M23.209 5H5.792A.792.792 0 0 0 5 5.791V23.21c0 .437.354.791.792.791h9.303v-7.125H12.72v-2.968h2.375v-2.375c0-2.455 1.553-3.662 3.741-3.662 1.049 0 1.95.078 2.213.112v2.565h-1.517c-1.192 0-1.469.567-1.469 1.397v1.963h2.969l-.594 2.968h-2.375L18.11 24h5.099a.791.791 0 0 0 .791-.791V5.79a.791.791 0 0 0-.791-.79"></path></svg></span></span></a><button class="button button--large button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon u-xs-show u-marginRight10" title="Share this story on Twitter or Facebook" aria-label="Share this story on Twitter or Facebook" data-action="show-share-popover" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--share svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M20.385 8H19a.5.5 0 1 0 .011 1h1.39c.43 0 .84.168 1.14.473.31.305.48.71.48 1.142v10.77c0 .43-.17.837-.47 1.142-.3.305-.71.473-1.14.473H8.62c-.43 0-.84-.168-1.144-.473a1.603 1.603 0 0 1-.473-1.142v-10.77c0-.43.17-.837.48-1.142A1.599 1.599 0 0 1 8.62 9H10a.502.502 0 0 0 0-1H8.615c-.67 0-1.338.255-1.85.766-.51.51-.765 1.18-.765 1.85v10.77c0 .668.255 1.337.766 1.848.51.51 1.18.766 1.85.766h11.77c.668 0 1.337-.255 1.848-.766.51-.51.766-1.18.766-1.85v-10.77c0-.668-.255-1.337-.766-1.848A2.61 2.61 0 0 0 20.384 8zm-8.67-2.508L14 3.207v8.362c0 .27.224.5.5.5s.5-.23.5-.5V3.2l2.285 2.285a.49.49 0 0 0 .704-.001.511.511 0 0 0 0-.708l-3.14-3.14a.504.504 0 0 0-.71 0L11 4.776a.501.501 0 0 0 .71.706" fill-rule="evenodd"></path></svg></span></button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon" data-action="scroll-to-responses" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--response svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M21.27 20.058c1.89-1.826 2.754-4.17 2.754-6.674C24.024 8.21 19.67 4 14.1 4 8.53 4 4 8.21 4 13.384c0 5.175 4.53 9.385 10.1 9.385 1.007 0 2-.14 2.95-.41.285.25.592.49.918.7 1.306.87 2.716 1.31 4.19 1.31.276-.01.494-.14.6-.36a.625.625 0 0 0-.052-.65c-.61-.84-1.042-1.71-1.282-2.58a5.417 5.417 0 0 1-.154-.75zm-3.85 1.324l-.083-.28-.388.12a9.72 9.72 0 0 1-2.85.424c-4.96 0-8.99-3.706-8.99-8.262 0-4.556 4.03-8.263 8.99-8.263 4.95 0 8.77 3.71 8.77 8.27 0 2.25-.75 4.35-2.5 5.92l-.24.21v.32c0 .07 0 .19.02.37.03.29.1.6.19.92.19.7.49 1.4.89 2.08-.93-.14-1.83-.49-2.67-1.06-.34-.22-.88-.48-1.16-.74z"></path></svg></span></button><button class="button button--chromeless u-baseColor--buttonNormal u-marginRight12" data-action="scroll-to-responses">9</button><button class="button button--large button--dark button--chromeless is-touchIconFadeInPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/b2133360b198" data-action-source="post_actions_footer"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--29px u-marginRight4"><svg class="svgIcon-use" width="29" height="29"><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4zM21 23l-5.91-3.955-.148-.107a.751.751 0 0 0-.884 0l-.147.107L8 23V6.615C8 5.725 8.725 5 9.615 5h9.77C20.275 5 21 5.725 21 6.615V23z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--29px u-marginRight4"><svg class="svgIcon-use" width="29" height="29"><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4z" fill-rule="evenodd"></path></svg></span></span></button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon js-moreActionsButton" title="More actions" aria-label="More actions" data-action="more-actions"><span class="svgIcon svgIcon--more svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="-480.5 272.5 21 21"><path d="M-463 284.6c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5z"></path></svg></span></button></div></div></div></div><div class="u-maxWidth740 u-paddingTop20 u-marginTop20 u-borderTopLightest container u-paddingBottom20 u-xs-paddingBottom10 js-postAttributionFooterContainer"><div class="row js-postFooterInfo"><div class="col u-size12of12"><li class="uiScale uiScale-ui--small uiScale-caption--regular u-block u-paddingBottom18 js-cardUser"><div class="u-marginLeft20 u-floatRight"><span class="followState js-followState" data-user-id="ec8d7b9beff6"><button class="button button--small u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton" data-action="sign-up-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-redirect="https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198" data-action-source="footer_card"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--small u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton" data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/ec8d7b9beff6" data-action-source="footer_card-ec8d7b9beff6-------------------------follow_footer"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="u-tableCell"><a class="link u-baseColor--link avatar" href="https://medium.com/@bambash?source=footer_card" title="Go to the profile of Nate Baker" aria-label="Go to the profile of Nate Baker" data-action-source="footer_card" data-user-id="ec8d7b9beff6" dir="auto"><img src="HA%20Kubernetes%20with%20Kubeadm%20%E2%80%93%20Nate%20Baker%20%E2%80%93%20Medium_files/1Oc72p_7gBI5lqVHFe3iPMw.jpeg" class="avatar-image avatar-image--small" alt="Go to the profile of Nate Baker"></a></div><div class="u-tableCell u-verticalAlignMiddle u-breakWord u-paddingLeft15"><h3 class="ui-h3 u-fontSize18 u-lineHeightTighter u-marginBottom4"><a class="link link--primary u-accentColor--hoverTextNormal" href="https://medium.com/@bambash" property="cc:attributionName" title="Go to the profile of Nate Baker" aria-label="Go to the profile of Nate Baker" rel="author cc:attributionUrl" data-user-id="ec8d7b9beff6" dir="auto">Nate Baker</a></h3></div></li></div></div></div><div class="js-postFooterPlacements"></div><div class="u-padding0 u-clearfix u-backgroundGrayLightest u-print-hide supplementalPostContent js-responsesWrapper"></div><div class="supplementalPostContent js-heroPromo"></div></footer></article></main><aside class="u-marginAuto u-maxWidth1000 js-postLeftSidebar"><div class="u-foreground u-top0 u-transition--fadeOut300 u-fixed u-sm-hide js-postShareWidget"><ul><li class="u-marginVertical10"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="b2133360b198" data-is-icon-29px="true" data-has-recommend-list="true" data-source="post_share_widget-----b2133360b198---------------------clap_sidebar"><div class="u-relative u-foreground"><button class="button button--primary button--large button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton clapButton--darker" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/b2133360b198" data-action-source="post_share_widget-----b2133360b198---------------------clap_sidebar" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><g fill-rule="evenodd"><path d="M13.739 1l.761 2.966L15.261 1z"></path><path d="M16.815 4.776l1.84-2.551-1.43-.471z"></path><path d="M10.378 2.224l1.84 2.551-.408-3.022z"></path><path d="M22.382 22.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L6.11 15.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L8.43 9.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L20.628 15c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM12.99 6.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><g fill-rule="evenodd"><path d="M13.738 1l.762 2.966L15.262 1z"></path><path d="M18.634 2.224l-1.432-.47-.408 3.022z"></path><path d="M11.79 1.754l-1.431.47 1.84 2.552z"></path><path d="M24.472 14.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M14.58 10.887c-.156-.83.096-1.569.692-2.142L12.78 6.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M17.812 10.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L9.2 7.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L7.046 9.54 5.802 8.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394l1.241 1.241 4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L4.89 11.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C21.74 20.8 22.271 18 20.62 14.982l-2.809-4.942z"></path></g></svg></span></span></button></div><span class="u-relative u-background js-actionMultirecommendCount u-marginLeft5"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton" data-action="show-recommends" data-action-value="b2133360b198">232</button></span></div></li><li class="u-marginVertical10 u-marginLeft3"><button class="button button--large button--dark button--chromeless is-touchIconFadeInPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/b2133360b198" data-action-source="post_share_widget-----b2133360b198---------------------bookmark_sidebar"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4zM21 23l-5.91-3.955-.148-.107a.751.751 0 0 0-.884 0l-.147.107L8 23V6.615C8 5.725 8.725 5 9.615 5h9.77C20.275 5 21 5.725 21 6.615V23z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4z" fill-rule="evenodd"></path></svg></span></span></button></li><li class="u-marginVertical10 u-marginLeft3"><a class="button button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon button--dark button--chromeless" href="https://medium.com/p/b2133360b198/share/twitter" title="Share on Twitter" aria-label="Share on Twitter" target="_blank" data-action-source="post_share_widget"><span class="button-defaultState"><span class="svgIcon svgIcon--twitterFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M22.053 7.54a4.474 4.474 0 0 0-3.31-1.455 4.526 4.526 0 0 0-4.526 4.524c0 .35.04.7.082 1.05a12.9 12.9 0 0 1-9.3-4.77c-.39.69-.61 1.46-.65 2.26.03 1.6.83 2.99 2.02 3.79-.72-.02-1.41-.22-2.02-.57-.01.02-.01.04 0 .08-.01 2.17 1.55 4 3.63 4.44-.39.08-.79.13-1.21.16-.28-.03-.57-.05-.81-.08.54 1.77 2.21 3.08 4.2 3.15a9.564 9.564 0 0 1-5.66 1.94c-.34-.03-.7-.06-1.05-.08 2 1.27 4.38 2.02 6.94 2.02 8.31 0 12.86-6.9 12.84-12.85.02-.24.01-.43 0-.65.89-.62 1.65-1.42 2.26-2.34-.82.38-1.69.62-2.59.72a4.37 4.37 0 0 0 1.94-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></span></span></a></li><li class="u-marginVertical10 u-marginLeft3"><a class="button button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon button--dark button--chromeless" href="https://medium.com/p/b2133360b198/share/facebook" title="Share on Facebook" aria-label="Share on Facebook" target="_blank" data-action-source="post_share_widget"><span class="button-defaultState"><span class="svgIcon svgIcon--facebookSquare svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M23.209 5H5.792A.792.792 0 0 0 5 5.791V23.21c0 .437.354.791.792.791h9.303v-7.125H12.72v-2.968h2.375v-2.375c0-2.455 1.553-3.662 3.741-3.662 1.049 0 1.95.078 2.213.112v2.565h-1.517c-1.192 0-1.469.567-1.469 1.397v1.963h2.969l-.594 2.968h-2.375L18.11 24h5.099a.791.791 0 0 0 .791-.791V5.79a.791.791 0 0 0-.791-.79"></path></svg></span></span></a></li></ul></div></aside><div class="u-fixed u-bottom0 u-width100pct u-backgroundWhite u-boxShadowTop u-borderBox u-paddingTop10 u-paddingBottom10 u-zIndexMetabar u-xs-paddingLeft10 u-xs-paddingRight10 js-stickyFooter"><div class="u-maxWidth700 u-marginAuto u-flexCenter"><div class="u-fontSize16 u-flex1 u-flexCenter"><div class="u-flex0 u-inlineBlock u-paddingRight20 u-xs-paddingRight10"><a class="link u-baseColor--link avatar u-inline" href="https://medium.com/@bambash" data-action="show-user-card" data-action-value="ec8d7b9beff6" data-action-type="hover" data-user-id="ec8d7b9beff6" dir="auto"><img src="HA%20Kubernetes%20with%20Kubeadm%20%E2%80%93%20Nate%20Baker%20%E2%80%93%20Medium_files/1Oc72p_7gBI5lqVHFe3iPMw_002.jpeg" class="avatar-image avatar-image--smaller" alt="Go to the profile of Nate Baker"></a></div><div class="u-flex1 u-inlineBlock"><div class="u-xs-hide">Never miss a story from<strong> Nate Baker</strong>, when you sign up for Medium. <a class="link u-baseColor--link link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@Medium/personalize-your-medium-experience-with-users-publications-tags-26a41ab1ee0c#.hx4zuv3mg" data-action-source="sticky_footer">Learn more</a></div><div class="u-xs-show">Never miss a story from<strong> Nate Baker</strong></div></div></div><div class="u-marginLeft50 u-xs-marginAuto"><span class="followState js-followState" data-user-id="ec8d7b9beff6"><button class="button u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton u-uiTextSemibold u-textUppercase u-fontSize12" data-action="sign-up-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-redirect="https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198" data-action-source="sticky_footer"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary is-active u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton u-uiTextSemibold u-textUppercase u-fontSize12" data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/ec8d7b9beff6" data-action-source="sticky_footer-ec8d7b9beff6-------------------------follow_metabar"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Get updates</span></button></span></div></div></div></div></div></div><div class="loadingBar"></div><script>// <![CDATA[
window["obvInit"] = function (opt_embedded) {window["obvInit"]["embedded"] = opt_embedded; window["obvInit"]["ready"] = true;}
// ]]></script><script>// <![CDATA[
var GLOBALS = {"audioUrl":"https://d1fcbxp97j4nb2.cloudfront.net","baseUrl":"https://medium.com","buildLabel":"36376-efcb381","currentUser":{"userId":"lo_dnt_Th85CGbAz0Mz","isVerified":false,"subscriberEmail":"","hasPastMemberships":false,"isEnrolledInHightower":false,"isEligibleForHightower":false,"hightowerLastLockedAt":0,"isWriterProgramEnrolled":false,"isWriterProgramInvited":false,"isWriterProgramOptedOut":false,"writerProgramVersion":0,"writerProgramEnrolledAt":0,"friendLinkOnboarding":0,"hasAdditionalUnlocks":false,"hasApiAccess":false},"currentUserHasUnverifiedEmail":false,"isAuthenticated":false,"isCurrentUserVerified":false,"language":"en-us","miroUrl":"https://cdn-images-1.medium.com","moduleUrls":{"base":"https://cdn-static-1.medium.com/_/fp/gen-js/main-base.bundle._eyIgqBdxuq6c9s7VIMg7A.js","common-async":"https://cdn-static-1.medium.com/_/fp/gen-js/main-common-async.bundle.uL-bCjAg-y1nYHq3LqNgVA.js","hightower":"https://cdn-static-1.medium.com/_/fp/gen-js/main-hightower.bundle.fHPGYc2oDDkFw85XAxZamg.js","home-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-home-screens.bundle.U1hMTFJF9dulaDLSIZdzLQ.js","misc-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-misc-screens.bundle.wXVHPCh_oniKqm7clBvMaA.js","notes":"https://cdn-static-1.medium.com/_/fp/gen-js/main-notes.bundle.JOkZKnWCAFAjHFj8wsiJgQ.js","payments":"https://cdn-static-1.medium.com/_/fp/gen-js/main-payments.bundle.F064-Bxe98LXZiC7tPpLqQ.js","posters":"https://cdn-static-1.medium.com/_/fp/gen-js/main-posters.bundle.Q__563Ts8G-l3d5LSY21Fw.js","power-readers":"https://cdn-static-1.medium.com/_/fp/gen-js/main-power-readers.bundle.euOfzGWscThmhkW6Bt7tuQ.js","pubs":"https://cdn-static-1.medium.com/_/fp/gen-js/main-pubs.bundle.yfEwUEzjt89Y-ezg2LZA5g.js","stats":"https://cdn-static-1.medium.com/_/fp/gen-js/main-stats.bundle.0d7F-M4dmcQbPtBcu3I1oQ.js"},"previewConfig":{"weightThreshold":1,"weightImageParagraph":0.51,"weightIframeParagraph":0.8,"weightTextParagraph":0.08,"weightEmptyParagraph":0,"weightP":0.003,"weightH":0.005,"weightBq":0.003,"minPTextLength":60,"truncateBoundaryChars":20,"detectTitle":true,"detectTitleLevThreshold":0.15},"productName":"Medium","supportsEdit":true,"termsUrl":"//medium.com/policy/9db0094a1e0f","textshotHost":"textshot.medium.com","transactionId":"1548911649608:3c4d0d723f23","useragent":{"browser":"firefox","family":"firefox","os":"","version":60,"supportsDesktopEdit":true,"supportsInteract":true,"supportsView":true,"isMobile":false,"isTablet":false,"isNative":false,"supportsFileAPI":true,"isTier1":true,"clientVersion":"","unknownParagraphsBad":false,"clientChannel":"","supportsRealScrollEvents":true,"supportsVhUnits":true,"ruinsViewportSections":false,"supportsHtml5Video":true,"supportsMagicUnderlines":true,"isWebView":false,"isFacebookWebView":false,"supportsProgressiveMedia":true,"supportsPromotedPosts":true,"isBot":false,"isNativeIphone":false,"supportsCssVariables":true,"supportsVideoSections":true,"emojiSupportLevel":1,"isSearchBot":false,"isSyndicationBot":false,"isNativeAndroid":false,"supportsScrollableMetabar":true},"variants":{"allow_access":true,"allow_signup":true,"allow_test_auth":"disallow","signin_services":"twitter,facebook,google,email,google-fastidv,google-one-tap","signup_services":"twitter,facebook,google,email,google-fastidv,google-one-tap","google_sign_in_android":true,"reengagement_notification_duration":3,"browsable_stream_config_bucket":"curated-topics","enable_dedicated_series_tab_api_ios":true,"enable_post_import":true,"available_monthly_plan":"60e220181034","available_annual_plan":"2c754bcc2995","disable_ios_resume_reading_toast":true,"is_not_medium_subscriber":true,"glyph_font_set":"m2","enable_branding":true,"enable_branding_fonts":true,"enable_fastrak_rollout_invited_users":true,"enable_friend_link_onboarding":true,"max_premium_content_per_user_under_metering":3,"enable_automated_mission_control_triggers":true,"enable_top_stories_for_you":true,"enable_lite_profile":true,"enable_topic_lifecycle_email":true,"enable_marketing_emails":true,"enable_truncated_rss_for_tags_and_topics":true,"enable_parsely":true,"enable_branch_io":true,"enable_synchronous_parsely":true,"enable_ios_post_stats":true,"enable_lite_topics":true,"enable_lite_stories":true,"redis_read_write_splitting":true,"enable_tipalti_onboarding":true,"enable_annual_renewal_reminder_email":true,"enable_janky_spam_rules":"users,posts","enable_new_collaborative_filtering_data":true,"android_rating_prompt_stories_read_threshold":2,"enable_gifting_flow":true,"stripe_v3":true,"enable_google_one_tap":true,"enable_email_sign_in_captcha":true,"enable_social_shares_in_new_tab":true,"enable_primary_topic_for_mobile":true},"xsrfToken":"","iosAppId":"828256236","supportEmail":"yourfriends@medium.com","fp":{"/icons/monogram-mask.svg":"https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg","/icons/favicon-dev-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-dev-editor.YKKRxBO8EMvIqhyCwIiJeQ.ico","/icons/favicon-hatch-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-hatch-editor.BuEyHIqlyh2s_XEk4Rl32Q.ico","/icons/favicon-medium-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium-editor.PiakrZWB7Yb80quUVQWM6g.ico"},"authBaseUrl":"https://medium.com","imageUploadSizeMb":25,"isAuthDomainRequest":true,"algoliaApiEndpoint":"https://MQ57UUUQZ2-dsn.algolia.net","algoliaAppId":"MQ57UUUQZ2","algoliaSearchOnlyApiKey":"394474ced050e3911ae2249ecc774921","iosAppStoreUrl":"https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8","iosAppLinkBaseUrl":"medium:","algoliaIndexPrefix":"medium_","androidPlayStoreUrl":"https://play.google.com/store/apps/details?id=com.medium.reader","googleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","androidPackage":"com.medium.reader","androidPlayStoreMarketScheme":"market://details?id=com.medium.reader","googleAuthUri":"https://accounts.google.com/o/oauth2/auth","androidScheme":"medium","layoutData":{"useDynamicScripts":false,"googleAnalyticsTrackingCode":"UA-24232453-2","jsShivUrl":"https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js","useDynamicCss":false,"faviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico","faviconImageId":"1*8I-HPL0bfoIzGied-dzOvA.png","fontSets":[{"id":8,"url":"https://glyph.medium.com/css/e/sr/latin/e/ssr/latin/e/ssb/latin/m2.css"},{"id":11,"url":"https://glyph.medium.com/css/m2.css"},{"id":9,"url":"https://glyph.medium.com/css/mkt.css"}],"editorFaviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium-editor.3Y6xpZ-0FSdWDnPM3hSBIA.ico","glyphUrl":"https://glyph.medium.com"},"authBaseUrlRev":"moc.muidem//:sptth","isDnt":true,"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","archiveUploadSizeMb":100,"paymentData":{"currencies":{"1":{"label":"US Dollar","external":"usd"}},"countries":{"1":{"label":"United States of America","external":"US"}},"accountTypes":{"1":{"label":"Individual","external":"individual"},"2":{"label":"Company","external":"company"}}},"previewConfig2":{"weightThreshold":1,"weightImageParagraph":0.05,"raiseImage":true,"enforceHeaderHierarchy":true,"isImageInsetRight":true},"isAmp":false,"iosScheme":"medium","isSwBoot":false,"facebook":{"key":"542599432471018","namespace":"medium-com","scope":{"default":["public_profile","email"],"connect":["public_profile","email"],"login":["public_profile","email"],"share":["public_profile","email"]}},"editorsPicksTopicId":"3985d2a191c5","popularOnMediumTopicId":"9d34e48ecf94","memberContentTopicId":"13d7efd82fb2","audioContentTopicId":"3792abbd134","brandedSequenceId":"7d337ddf1941","isDoNotAuth":false,"goldfinchUrl":"https://goldfinch.medium.com","buggle":{"url":"https://buggle.medium.com","videoUrl":"https://cdn-videos-1.medium.com","audioUrl":"https://cdn-audio-1.medium.com"},"referrerType":2,"isMeteredOut":false,"meterConfig":{"maxUnlockCount":3,"windowLength":"MONTHLY"},"partnerProgramEmail":"partnerprogram@medium.com","userResearchPrompts":[{"promptId":"lo_post_page_4","type":0,"url":"www.calendly.com"},{"promptId":"lo_home_page","type":1,"url":"www.calendly.com"},{"promptId":"lo_profile_page","type":2,"url":"www.calendly.com"}],"recaptchaKey":"6LdAokEUAAAAAC7seICd4vtC8chDb3jIXDQulyUJ","signinWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"countryCode":"FR","bypassMeter":false,"branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","paypal":{"clientMode":"production","oneYearGift":{"name":"Medium Membership (1 Year, Digital Gift Code)","description":"Unlimited access to the best and brightest stories on Medium. Gift codes can be redeemed at medium.com/redeem.","price":"50.00","currency":"USD","sku":"membership-gift-1-yr"}}}
// ]]></script><script charset="UTF-8" src="HA%20Kubernetes%20with%20Kubeadm%20%E2%80%93%20Nate%20Baker%20%E2%80%93%20Medium_files/main-base.js" async=""></script><script>// <![CDATA[
window["obvInit"]({"value":{"id":"b2133360b198","versionId":"939c05fa9a66","creatorId":"ec8d7b9beff6","creator":{"userId":"ec8d7b9beff6","name":"Nate Baker","username":"bambash","createdAt":1507037295103,"imageId":"1*Oc72p_7gBI5lqVHFe3iPMw.jpeg","backgroundImageId":"","bio":"","twitterScreenName":"","socialStats":{"userId":"ec8d7b9beff6","usersFollowedCount":4,"usersFollowedByCount":28,"type":"SocialStats"},"social":{"userId":"lo_dnt_Th85CGbAz0Mz","targetUserId":"ec8d7b9beff6","type":"Social"},"facebookAccountId":"","allowNotes":1,"mediumMemberAt":0,"isNsfw":false,"type":"User"},"homeCollectionId":"","title":"HA Kubernetes with Kubeadm","detectedLanguage":"en","latestVersion":"939c05fa9a66","latestPublishedVersion":"939c05fa9a66","hasUnpublishedEdits":false,"latestRev":2603,"createdAt":1507058888374,"updatedAt":1540448889179,"acceptedAt":0,"firstPublishedAt":1507147326569,"latestPublishedAt":1540448889179,"vote":false,"experimentalCss":"","displayAuthor":"","content":{"subtitle":"*Updated for 1.11*","bodyModel":{"paragraphs":[{"name":"2695","type":3,"text":"HA Kubernetes with Kubeadm","markups":[]},{"name":"e08d","type":1,"text":"*Updated for 1.11*","markups":[{"type":1,"start":0,"end":18}]},{"name":"a660","type":1,"text":"This post is geared towards users who are already using Kubeadm to deploy their Kubernetes clusters. If you’re not familiar with Kubeadm, check it out here: https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/","markups":[{"type":3,"start":157,"end":225,"href":"https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/","title":"","rel":"nofollow noopener noopener noopener","anchorType":0}]},{"name":"e045","type":1,"text":"If you’ve referenced this post in the past for 1.7–1.10, a lot has changed with 1.11 and 1.12.","markups":[]},{"name":"a0ba","type":1,"text":"An HA guide has been added to the official Kubernetes documentation: https://kubernetes.io/docs/setup/independent/high-availability/","markups":[{"type":3,"start":69,"end":132,"href":"https://kubernetes.io/docs/setup/independent/high-availability/","title":"","rel":"nofollow noopener noopener","anchorType":0}]},{"name":"f7ac","type":3,"text":"Background","markups":[]},{"name":"d465","type":1,"text":"I’m creating this in hopes that it helps people with their Kubernetes journey. When first starting out, I followed the very popular “Kubernetes The Hardway”guide: https://github.com/kelseyhightower/kubernetes-the-hard-way. It’s a great starting point for those who want to understand the ins and outs of how Kubernetes operates. While its good to know how all of the Kubernetes pieces connect, it can be time consuming.","markups":[{"type":3,"start":163,"end":221,"href":"https://github.com/kelseyhightower/kubernetes-the-hard-way","title":"","rel":"nofollow noopener noopener noopener noopener noopener noopener noopener","anchorType":0}]},{"name":"d59e","type":3,"text":"Kubeadm","markups":[]},{"name":"8b46","type":1,"text":"Kubeadm is great for standing up a k8s cluster. However it does not support multi-master deployments. It’s something that is being actively worked on, but for now you have to handle high availability on your own. That said, by using kubeadm phases, you are able to configure a highly available cluster in a few steps.","markups":[{"type":3,"start":0,"end":7,"href":"https://kubernetes.io/docs/setup/independent/install-kubeadm/","title":"","rel":"noopener","anchorType":0},{"type":3,"start":233,"end":247,"href":"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-alpha/","title":"","rel":"","anchorType":0}]},{"name":"8239","type":3,"text":"Creating a multi-master cluster","markups":[]},{"name":"571b","type":1,"text":"A few servers, a load balancer, and kubeadm are the only tools needed to set this up. It’s configured using the load balancer for node (kubelet), and kubectl communication. You could achieve this setup on a hosting provider, or on prem by leveraging HAproxy. You’ll just need something to load balance traffic for the master nodes. Setup each master node using port :6443 as a backend for your load balancer of choice.","markups":[]},{"name":"c7ab","type":1,"text":"Let’s assume the following:","markups":[{"type":1,"start":0,"end":27}]},{"name":"9792","type":8,"text":"etcd   1 address      = 10.0.0.6\netcd   2 address      = 10.0.0.7\netcd   3 address      = 10.0.0.8","markups":[]},{"name":"00dc","type":8,"text":"master 1 address      = 10.0.0.50\nmaster 2 address      = 10.0.0.51\nmaster 3 address      = 10.0.0.52","markups":[]},{"name":"4703","type":8,"text":"load balancer address = 10.0.0.200","markups":[]},{"name":"898f","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*7YItLT6IKYqNcVtDPeiyOQ.jpeg","originalWidth":531,"originalHeight":651}},{"name":"1109","type":13,"text":"Step 1 — Deploy your servers","markups":[]},{"name":"4c08","type":1,"text":"Before beginning, make sure your servers have been deployed with the necessary prerequisites.","markups":[{"type":3,"start":69,"end":92,"href":"https://kubernetes.io/docs/setup/independent/install-kubeadm/#before-you-begin","title":"","rel":"noopener","anchorType":0}]},{"name":"8672","type":13,"text":"Step 2 — Setup etcd","markups":[]},{"name":"7c0b","type":1,"text":"Skip this step if an etcd cluster is already available.","markups":[{"type":2,"start":0,"end":55}]},{"name":"bbd6","type":1,"text":"There are a few different ways to deploy etcd. This article assumes you’ve followed the kubeadm documentation. If so, the etcd nodes will use the kubelet, docker, and a static kube manifest to form their quorum. If you already have a cluster, make the necessary adjustments to the config in the following steps.","markups":[{"type":3,"start":88,"end":109,"href":"https://kubernetes.io/docs/setup/independent/setup-ha-etcd-with-kubeadm/","title":"","rel":"noopener","anchorType":0}]},{"name":"8225","type":1,"text":"The CA created for etcd will be used later when provisioning the master nodes.","markups":[]},{"name":"5bb4","type":13,"text":"Step 3 — Kubeadm config for masters","markups":[]},{"name":"dcd8","type":1,"text":"The kubeadm config allows for customization of the certificates and manifests that are needed when deploying Kubernetes. It should include information about the api endpoints, etcd endpoints/certs, the bootstrap token, and what hostnames/ip addresses should be included in the certificates.","markups":[]},{"name":"62ff","type":1,"text":"Before you setup the config, generate a token.","markups":[{"type":3,"start":40,"end":45,"href":"https://kubernetes.io/docs/admin/kubeadm/#manage-tokens","title":"","rel":"noopener","anchorType":0}]},{"name":"b498","type":1,"text":"kubeadm token generate","markups":[{"type":10,"start":0,"end":22}]},{"name":"926e","type":1,"text":"Example kubeadm config file:","markups":[{"type":1,"start":0,"end":28}]},{"name":"76f4","type":8,"text":"apiVersion: kubeadm.k8s.io/v1alpha2\nkind: MasterConfiguration\nkubernetesVersion: v1.11.3\napi:\n  controlPlaneEndpoint: \"10.0.0.200:6443\"\netcd:\n  external:\n    endpoints:\n    - https://10.0.0.6:2379\n    - https://10.0.0.7:2379\n    - https://10.0.0.8:2379\n    caFile: /etc/kubernetes/pki/etcd/ca.crt\n    certFile: /etc/kubernetes/pki/apiserver-etcd-client.crt\n    keyFile: /etc/kubernetes/pki/apiserver-etcd-client.key\napiServerExtraArgs:\n  apiserver-count: \"3\"\napiServerCertSANs:\n- kubernetes.default\n- kubernetes.default.svc.cluster.local\n- 10.0.0.200\n- 10.0.0.50\n- 10.0.0.51\n- 10.0.0.52\n- master-01-hostname\n- master-02-hostname\n- master-03-hostname\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: \x3cyour token from the step above\x3e\n  ttl: '0'\n  usages:\n  - signing\n  - authentication","markups":[{"type":3,"start":175,"end":196,"href":"https://10.10.0.11:2379","title":"","rel":"nofollow noopener","anchorType":0},{"type":3,"start":203,"end":224,"href":"https://10.10.2.11:2379","title":"","rel":"nofollow noopener","anchorType":0},{"type":3,"start":231,"end":252,"href":"https://10.10.4.11:2379","title":"","rel":"nofollow noopener","anchorType":0}]},{"name":"1112","type":1,"text":"The etcd certs should have been generated during the etcd cluster setup. Be sure to include the additional SANs for yourAPI Server certificate. It needs to include all master addresses AND the load balancer address! Also, take note of the kubeadm api version. The config file may need to change depending on the version of kubeadm and Kubernetes. Save this file as kubeadmcfg.yaml","markups":[{"type":10,"start":365,"end":380},{"type":2,"start":185,"end":189}]},{"name":"6d60","type":13,"text":"Step 4 — Distribute the etcd apiserver client certificates","markups":[]},{"name":"0bab","type":1,"text":"Before distributing the kubeadm config to the master nodes, you must first distribute the etcd certificates. Without them, the kube apiserver will not be able to communicate securely with etcd. Be sure the following files exist on the master nodes:","markups":[]},{"name":"7bfc","type":8,"text":"/etc/kubernetes/pki\n├── apiserver-etcd-client.crt\n├── apiserver-etcd-client.key\n└── etcd\n    └── ca.crt","markups":[{"type":10,"start":0,"end":103}]},{"name":"e8e9","type":1,"text":"They were generated during etcd bootstraping viakubeadm alpha phase certs apiserver-etcd-client --config=/path/to/etcd/kubeadmcfg.yaml","markups":[{"type":10,"start":48,"end":134}]},{"name":"9175","type":13,"text":"Step 5 — Distribute the kubeadmcfg.yaml","markups":[]},{"name":"3d01","type":1,"text":"Once the etcd certs are in place, the config should be distributed to each master. The file can be placed anywhere, but this article will assume it exists at /tmp/kubeadmcfg.yaml.","markups":[{"type":10,"start":158,"end":178}]},{"name":"7f52","type":13,"text":"Step 6 — Generate the master CA","markups":[]},{"name":"6c0f","type":1,"text":"Before running kubeadm init, we need to generate the master certificate authority. It will be used to create and sign the certs and keys for the master nodes. This only needs to be done once! The CA will be reused on the other master nodes.","markups":[{"type":10,"start":15,"end":27},{"type":1,"start":159,"end":240}]},{"name":"d7e5","type":1,"text":"On the first master node, run the following:","markups":[]},{"name":"a9a0","type":8,"text":"kubeadm alpha phase certs ca --config=/tmp/kubeadmcfg.yaml\nkubeadm alpha phase certs front-proxy-ca --config=/tmp/kubeadmcfg.yaml\nkubeadm alpha phase certs sa --config=/tmp/kubeadmcfg.yaml","markups":[]},{"name":"28f1","type":1,"text":"The directory tree should look something like this:","markups":[]},{"name":"98da","type":8,"text":"/etc/kubernetes\n├── pki\n│   ├── apiserver-etcd-client.crt\n│   ├── apiserver-etcd-client.key\n│   ├── ca.crt\n│   ├── ca.key\n│   ├── etcd\n│   │   ├── ca.crt\n│   ├── front-proxy-ca.crt\n│   ├── front-proxy-ca.key\n│   ├── front-proxy-client.crt\n│   ├── front-proxy-client.key\n│   ├── sa.key\n│   └── sa.pub\n└── scheduler.conf","markups":[]},{"name":"2df5","type":13,"text":"Step 7 — Distribute the master PKI","markups":[]},{"name":"adff","type":1,"text":"If the CA was created successfully, you should have a directory with all of the kubelet certs and keys in /etc/kubernetes/pki. This directory will need to be distributed to the other 2 master instances. Sync the pki directory to /etc/kubernetes on the other masters.","markups":[{"type":10,"start":106,"end":125},{"type":10,"start":212,"end":215},{"type":10,"start":229,"end":244}]},{"name":"e4cd","type":13,"text":"Step 8 — Initialize the master control plane","markups":[]},{"name":"5210","type":1,"text":"When all PKI certs/keys are in place and etcd is running, the master nodes can be initialized. On each master, run the following:","markups":[]},{"name":"2087","type":8,"text":"kubeadm init --config /tmp/kubeadmcfg.yaml","markups":[]},{"name":"1b3a","type":1,"text":"On a successful initialization, you’ll have a 3 master nodes that are ready to roll. The /etc/kubernetes directory should look like this:","markups":[{"type":10,"start":89,"end":104}]},{"name":"d98f","type":8,"text":"/etc/kubernetes\n├── admin.conf\n├── controller-manager.conf\n├── kubelet.conf\n├── manifests\n│   ├── kube-apiserver.yaml\n│   ├── kube-controller-manager.yaml\n│   └── kube-scheduler.yaml\n├── pki\n│   ├── apiserver.crt\n│   ├── apiserver-etcd-client.crt\n│   ├── apiserver-etcd-client.key\n│   ├── apiserver.key\n│   ├── apiserver-kubelet-client.crt\n│   ├── apiserver-kubelet-client.key\n│   ├── ca.crt\n│   ├── ca.key\n│   ├── etcd\n│   │   ├── ca.crt\n│   ├── front-proxy-ca.crt\n│   ├── front-proxy-ca.key\n│   ├── front-proxy-client.crt\n│   ├── front-proxy-client.key\n│   ├── sa.key\n│   └── sa.pub\n└── scheduler.conf","markups":[]},{"name":"2d12","type":1,"text":"Double check the manifests to be sure the kubeadm config was properly read. You should see your external etcd information in the kube-apiserver.yaml manifest.","markups":[{"type":10,"start":129,"end":148}]},{"name":"f90c","type":1,"text":"Take note of the join that is output during initialization. It’s needed when adding worker nodes.","markups":[{"type":10,"start":17,"end":21}]},{"name":"1328","type":8,"text":"kubeadm join --token \x3cYOUR_KUBE_TOKEN\x3e 10.0.0.50:6443 --discovery-token-ca-cert-hash sha256:89870e4215b92262c5093b3f4f6d57be8580c3442ed6c8b00b0b30822c41e5b3","markups":[{"type":10,"start":0,"end":156}]},{"name":"4060","type":13,"text":"Step 9 — Setup kubectl","markups":[]},{"name":"ddbf","type":1,"text":"If the above steps are complete, and your load balancer is setup to handle the masters, then you should have a highly available master setup! Alright!","markups":[]},{"name":"2b74","type":1,"text":"Verify the cluster is working by setting up kubectl to communicate with the load balancer.","markups":[{"type":10,"start":44,"end":51}]},{"name":"978e","type":1,"text":"Setup kubectl like you would normally by copying /etc/kubernetes/admin.conf into ~/.kube/config","markups":[{"type":10,"start":6,"end":13},{"type":10,"start":49,"end":75},{"type":10,"start":81,"end":95}]},{"name":"270d","type":1,"text":"Edit ~/.kube/config and change server: 10.0.0.50 to server: 10.0.0.200","markups":[{"type":10,"start":5,"end":19},{"type":10,"start":31,"end":48},{"type":10,"start":52,"end":70}]},{"name":"3b0b","type":1,"text":"Run kubectl get nodes and you should see output similar to:","markups":[{"type":10,"start":4,"end":21}]},{"name":"e49f","type":8,"text":"NAME         STATUS    ROLES     AGE       VERSION\n10.0.0.50    Ready     master    1h        v1.11.3\n10.0.0.51    Ready     master    1h        v1.11.3\n10.0.0.52    Ready     master    1h        v1.11.3","markups":[]},{"name":"9d18","type":1,"text":"Don’t forget to apply the network overlay, otherwise the Status will display “NotReady”. (I use weave)","markups":[{"type":3,"start":16,"end":41,"href":"https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#pod-network","title":"","rel":"noopener","anchorType":0},{"type":3,"start":96,"end":101,"href":"https://github.com/weaveworks/weave","title":"","rel":"noopener","anchorType":0},{"type":2,"start":89,"end":102}]},{"name":"b7e5","type":13,"text":"Step 10 — Join nodes to the cluster","markups":[]},{"name":"0aff","type":1,"text":"Now that you have a functional master cluster, join some worker nodes!","markups":[]},{"name":"af4c","type":1,"text":"On any of your workers, run:","markups":[]},{"name":"8504","type":8,"text":"kubeadm join --token YOUR_CLUSTER_TOKEN 10.0.0.200:6443 --discovery-token-ca-cert-hash sha256:89870e4215b92262c5093b3f4f6d57be8580c3442ed6c8b00b0b30822c41e5b3","markups":[{"type":10,"start":0,"end":158}]},{"name":"c064","type":1,"text":"And that’s it! If everything was setup cleanly, you should now have a highly available cluster. Start joining workers, and take over the world!","markups":[]},{"name":"2d96","type":3,"text":"Closing Thoughts","markups":[]},{"name":"f7fa","type":1,"text":"Using the kubeadm config file is still in alpha, things will change as kubeadm matures. If you’re running on a cloud provider, like AWS, you can add those things into the config file. Almost anything you can include in static manifests can be added to the kubeadm config. It’s possible to automate all of this, it just takes a little TLC.","markups":[]},{"name":"c413","type":1,"text":"Hopefully the process of distributing PKI and leveraging a load balancer becomes more streamlined.","markups":[]},{"name":"4620","type":1,"text":"This is just one way to achieve HA with kubeadm. I probably missed a few things, so please feel free to make adjustments and leave suggestions in the comments!","markups":[]},{"name":"69de","type":1,"text":"Thanks!","markups":[]},{"name":"5d92","type":1,"text":"Nate","markups":[]}],"sections":[{"name":"8b1f","startIndex":0}]},"postDisplay":{"coverless":true}},"virtuals":{"allowNotes":true,"previewImage":{"imageId":"1*7YItLT6IKYqNcVtDPeiyOQ.jpeg","filter":"","backgroundSize":"","originalWidth":531,"originalHeight":651,"strategy":"resample","height":0,"width":0},"wordCount":1382,"imageCount":1,"readingTime":5.415094339622642,"subtitle":"*Updated for 1.11*","usersBySocialRecommends":[],"noIndex":false,"recommends":62,"socialRecommends":[],"isBookmarked":false,"tags":[{"slug":"kubernetes","name":"Kubernetes","postCount":6655,"metadata":{"postCount":6655,"coverImage":{"id":"1*c2HXMmSKX2u0N_WXqYfBgw.png","originalWidth":2372,"originalHeight":872,"isFeatured":true}},"type":"Tag"},{"slug":"docker","name":"Docker","postCount":14921,"metadata":{"postCount":14921,"coverImage":{"id":"1*dj93LUOWPHHiYWS1bh5zDQ.jpeg","originalWidth":1920,"originalHeight":1440,"isFeatured":true}},"type":"Tag"},{"slug":"tech","name":"Tech","postCount":144311,"metadata":{"postCount":144311,"coverImage":{"id":"1*TjFEp_SQMG3xh41Ly9cKig.png","originalWidth":662,"originalHeight":503,"isFeatured":true}},"type":"Tag"},{"slug":"cloud-computing","name":"Cloud Computing","postCount":23230,"metadata":{"postCount":23230,"coverImage":{"id":"1*BU46LufhEIhxIt_BUyPaRQ.jpeg","originalWidth":1000,"originalHeight":504,"isFeatured":true}},"type":"Tag"},{"slug":"container-orchestration","name":"Container Orchestration","postCount":244,"metadata":{"postCount":244,"coverImage":{"id":"0*byeqo-pBXVPU6xjq","originalWidth":1229,"originalHeight":831,"isFeatured":true,"focusPercentX":55,"focusPercentY":62}},"type":"Tag"}],"socialRecommendsCount":0,"responsesCreatedCount":9,"links":{"entries":[{"url":"https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#pod-network","alts":[],"httpStatus":200},{"url":"https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/","alts":[],"httpStatus":200},{"url":"https://kubernetes.io/docs/setup/independent/install-kubeadm/","alts":[],"httpStatus":200},{"url":"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-alpha/","alts":[],"httpStatus":200},{"url":"https://github.com/weaveworks/weave","alts":[],"httpStatus":200},{"url":"https://kubernetes.io/docs/setup/independent/high-availability/","alts":[],"httpStatus":200},{"url":"https://github.com/kelseyhightower/kubernetes-the-hard-way","alts":[],"httpStatus":200},{"url":"https://kubernetes.io/docs/setup/independent/setup-ha-etcd-with-kubeadm/","alts":[],"httpStatus":200},{"url":"https://kubernetes.io/docs/admin/kubeadm/#manage-tokens","alts":[],"httpStatus":200},{"url":"https://kubernetes.io/docs/setup/independent/install-kubeadm/#before-you-begin","alts":[],"httpStatus":200},{"url":"https://10.10.4.11:2379","alts":[],"httpStatus":0},{"url":"https://10.10.2.11:2379","alts":[],"httpStatus":0},{"url":"https://10.10.0.11:2379","alts":[],"httpStatus":0}],"version":"0.3","generatedAt":1540448899524},"isLockedPreviewOnly":false,"takeoverId":"","metaDescription":"","totalClapCount":232,"sectionCount":1,"readingList":0,"topics":[]},"coverless":true,"slug":"ha-kubernetes-cluster-via-kubeadm","translationSourcePostId":"","translationSourceCreatorId":"","isApprovedTranslation":false,"inResponseToPostId":"","inResponseToRemovedAt":0,"isTitleSynthesized":true,"allowResponses":true,"importedUrl":"","importedPublishedAt":0,"visibility":0,"uniqueSlug":"ha-kubernetes-cluster-via-kubeadm-b2133360b198","previewContent":{"bodyModel":{"paragraphs":[{"name":"2695","type":3,"text":"HA Kubernetes with Kubeadm","markups":[],"alignment":1},{"name":"e08d","type":1,"text":"*Updated for 1.11*","markups":[{"type":1,"start":0,"end":18}],"alignment":1},{"name":"a660","type":1,"text":"This post is geared towards users who are already using Kubeadm to deploy their Kubernetes clusters. If you’re not familiar with Kubeadm, check it out here: https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/","markups":[{"type":3,"start":157,"end":225,"href":"https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/","title":"","rel":"nofollow noopener noopener noopener","anchorType":0}],"alignment":1}],"sections":[{"startIndex":0}]},"isFullContent":false,"subtitle":"*Updated for 1.11*"},"license":0,"inResponseToMediaResourceId":"","canonicalUrl":"https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198","approvedHomeCollectionId":"","newsletterId":"","webCanonicalUrl":"https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198","mediumUrl":"https://medium.com/@bambash/ha-kubernetes-cluster-via-kubeadm-b2133360b198","migrationId":"","notifyFollowers":true,"notifyTwitter":false,"notifyFacebook":false,"responseHiddenOnParentPostAt":0,"isSeries":false,"isSubscriptionLocked":false,"seriesLastAppendedAt":0,"audioVersionDurationSec":0,"sequenceId":"","isNsfw":false,"isEligibleForRevenue":false,"isBlockedFromHightower":false,"deletedAt":0,"lockedPostSource":0,"hightowerMinimumGuaranteeStartsAt":0,"hightowerMinimumGuaranteeEndsAt":0,"featureLockRequestAcceptedAt":0,"mongerRequestType":1,"layerCake":0,"socialTitle":"","socialDek":"","editorialPreviewTitle":"","editorialPreviewDek":"","curationEligibleAt":0,"type":"Post"},"mentionedUsers":[],"collaborators":[],"collectionUserRelations":[],"mode":null,"references":{"User":{"ec8d7b9beff6":{"userId":"ec8d7b9beff6","name":"Nate Baker","username":"bambash","createdAt":1507037295103,"imageId":"1*Oc72p_7gBI5lqVHFe3iPMw.jpeg","backgroundImageId":"","bio":"","twitterScreenName":"","socialStats":{"userId":"ec8d7b9beff6","usersFollowedCount":4,"usersFollowedByCount":28,"type":"SocialStats"},"social":{"userId":"lo_dnt_Th85CGbAz0Mz","targetUserId":"ec8d7b9beff6","type":"Social"},"facebookAccountId":"","allowNotes":1,"mediumMemberAt":0,"isNsfw":false,"type":"User"}},"Social":{"ec8d7b9beff6":{"userId":"lo_dnt_Th85CGbAz0Mz","targetUserId":"ec8d7b9beff6","type":"Social"}},"SocialStats":{"ec8d7b9beff6":{"userId":"ec8d7b9beff6","usersFollowedCount":4,"usersFollowedByCount":28,"type":"SocialStats"}}}})
// ]]></script><script type="text/javascript">(function(b,r,a,n,c,h,_,s,d,k){if(!b[n]||!b[n]._q){for(;s<_.length;)c(h,_[s++]);d=r.createElement(a);d.async=1;d.src="https://cdn.branch.io/branch-latest.min.js";k=r.getElementsByTagName(a)[0];k.parentNode.insertBefore(d,k);b[n]=h}})(window,document,"script","branch",function(b,r){b[r]=function(){b._q.push([r,arguments])}},{_q:[],_v:1},"addListener applyCode autoAppIndex banner closeBanner closeJourney creditHistory credits data deepview deepviewCta first getCode init link logout redeem referrals removeListener sendSMS setBranchViewData setIdentity track validateCode trackCommerceEvent logEvent".split(" "), 0); branch.init('key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm', {'no_journeys': true, 'disable_exit_animation': true, 'disable_entry_animation': true}, function(err, data) {});</script></body></html>