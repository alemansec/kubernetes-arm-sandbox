<!DOCTYPE html>
<html xmlns:cc="http://creativecommons.org/ns#"><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# medium-com: http://ogp.me/ns/fb/medium-com#"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=contain"><title>Managing my Home with Kubernetes, Traefik, and Raspberry Pi’s</title><link rel="canonical" href="https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a"><meta name="title" content="Managing my Home with Kubernetes, Traefik, and Raspberry Pi’s"><meta name="referrer" content="unsafe-url"><meta name="description" content="I recently bought some Wifi enabled smart switches to allow me to control some table lamps at home. They’re great: super cheap in comparison to some other offerings, simple to setup, and they work…"><meta name="theme-color" content="#000000"><meta property="og:title" content="Managing my Home with Kubernetes, Traefik, and Raspberry Pi’s"><meta property="twitter:title" content="Managing my Home with Kubernetes, Traefik, and Raspberry Pi’s"><meta property="og:url" content="https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a"><meta property="og:image" content="https://cdn-images-1.medium.com/max/1200/1*5EE7y57XvUKdmfvA0pCkRQ.png"><meta property="fb:app_id" content="542599432471018"><meta property="og:description" content="I recently bought some Wifi enabled smart switches to allow me to control some table lamps at home. They’re great: super cheap in…"><meta name="twitter:description" content="I recently bought some Wifi enabled smart switches to allow me to control some table lamps at home. They’re great: super cheap in…"><meta name="twitter:image:src" content="https://cdn-images-1.medium.com/max/1200/1*5EE7y57XvUKdmfvA0pCkRQ.png"><link rel="publisher" href="https://plus.google.com/103654360130207659246"><link rel="author" href="https://medium.com/@evnsio"><meta property="author" content="Chris Evans"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta property="article:publisher" content="https://www.facebook.com/medium"><meta property="article:author" content="https://medium.com/@evnsio"><meta name="robots" content="index, follow"><meta property="article:published_time" content="2018-01-16T11:37:26.481Z"><meta name="twitter:creator" content="@evnsio"><meta name="twitter:site" content="@Medium"><meta property="og:site_name" content="Medium"><meta name="twitter:label1" value="Reading time"><meta name="twitter:data1" value="6 min read"><meta name="twitter:app:name:iphone" content="Medium"><meta name="twitter:app:id:iphone" content="828256236"><meta name="twitter:app:url:iphone" content="medium://p/d0330effea9a"><meta property="al:ios:app_name" content="Medium"><meta property="al:ios:app_store_id" content="828256236"><meta property="al:android:package" content="com.medium.reader"><meta property="al:android:app_name" content="Medium"><meta property="al:ios:url" content="medium://p/d0330effea9a"><meta property="al:android:url" content="medium://p/d0330effea9a"><meta property="al:web:url" content="https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a"><link rel="search" type="application/opensearchdescription+xml" title="Medium" href="https://medium.com/osd.xml"><link rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/d0330effea9a"><script type="application/ld+json">{"@context":"http://schema.org","@type":"NewsArticle","image":{"@type":"ImageObject","width":988,"height":610,"url":"https://cdn-images-1.medium.com/max/1976/1*5EE7y57XvUKdmfvA0pCkRQ.png"},"url":"https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a","dateCreated":"2018-01-16T11:37:26.481Z","datePublished":"2018-01-16T11:37:26.481Z","dateModified":"2018-06-19T13:37:49.487Z","headline":"Managing my Home with Kubernetes, Traefik, and Raspberry Pi’s","name":"Managing my Home with Kubernetes, Traefik, and Raspberry Pi’s","thumbnailUrl":"https://cdn-images-1.medium.com/max/1976/1*5EE7y57XvUKdmfvA0pCkRQ.png","keywords":["Tag:Kubernetes","Tag:Traefik","Tag:Raspberry Pi","Tag:Home Automation","Tag:Smart Home","LockedPostSource:0","Elevated:false","LayerCake:0"],"author":{"@type":"Person","name":"Chris Evans","url":"https://medium.com/@evnsio"},"creator":["Chris Evans"],"publisher":{"@type":"Organization","name":"Medium","url":"https://medium.com/","logo":{"@type":"ImageObject","width":308,"height":60,"url":"https://cdn-images-1.medium.com/max/616/1*OMF3fSqH8t4xBJ9-6oZDZw.png"}},"mainEntityOfPage":"https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a"}</script><meta name="parsely-link" content="https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a"><link rel="stylesheet" type="text/css" class="js-glyph-" id="glyph-8" href="Managing%20my%20Home%20with%20Kubernetes,%20Traefik,%20and%20Raspberry%20Pi%E2%80%99s_files/m2.css"><link rel="stylesheet" href="Managing%20my%20Home%20with%20Kubernetes,%20Traefik,%20and%20Raspberry%20Pi%E2%80%99s_files/main-branding-base.css"><script>if (window.top !== window.self) window.top.location = window.self.location.href;var OB_startTime = new Date().getTime(); var OB_loadErrors = []; function _onerror(e) { OB_loadErrors.push(e) }; if (document.addEventListener) document.addEventListener("error", _onerror, true); else if (document.attachEvent) document.attachEvent("onerror", _onerror); function _asyncScript(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("script"); s.type = "text/javascript"; s.async = true; s.src = u; f.parentNode.insertBefore(s, f);}function _asyncStyles(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("link"); s.rel = "stylesheet"; s.href = u; f.parentNode.insertBefore(s, f); return s}(new Image()).src = "/_/stat?event=pixel.load&origin=" + encodeURIComponent(location.origin);</script><!--[if lt IE 9]><script charset="UTF-8" src="https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js"></script><![endif]--><link rel="icon" href="https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico" class="js-favicon"><link rel="apple-touch-icon" sizes="152x152" href="https://cdn-images-1.medium.com/fit/c/304/304/1*8I-HPL0bfoIzGied-dzOvA.png"><link rel="apple-touch-icon" sizes="120x120" href="https://cdn-images-1.medium.com/fit/c/240/240/1*8I-HPL0bfoIzGied-dzOvA.png"><link rel="apple-touch-icon" sizes="76x76" href="https://cdn-images-1.medium.com/fit/c/152/152/1*8I-HPL0bfoIzGied-dzOvA.png"><link rel="apple-touch-icon" sizes="60x60" href="https://cdn-images-1.medium.com/fit/c/120/120/1*8I-HPL0bfoIzGied-dzOvA.png"><link rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg" color="#171717"></head><body itemscope="" class=" postShowScreen browser-firefox is-withMagicUnderlines v-glyph v-glyph--m2 is-noJs"><script>document.body.className = document.body.className.replace(/(^|\s)is-noJs(\s|$)/, "$1is-js$2")</script><div class="site-main" id="container"><div class="butterBar butterBar--error"></div><div class="surface"><div id="prerendered" class="screenContent"><canvas class="canvas-renderer"></canvas><div class="container u-maxWidth740 u-xs-margin0 notesPositionContainer js-notesPositionContainer"></div><div class="metabar u-clearfix js-metabar u-boxShadow4px12pxBlackLightest u-fixed u-backgroundTransparentWhiteDarkest u-xs-sizeFullViewportWidth"><div class="branch-journeys-top"></div><div class="js-metabarMiddle metabar-inner u-marginAuto u-maxWidth1032 u-flexCenter u-justifyContentSpaceBetween u-height65 u-xs-height56 u-paddingHorizontal20"><div class="metabar-block u-flex1 u-flexCenter"><div class="u-xs-hide js-metabarLogoLeft"><a href="https://medium.com/" data-log-event="home" class="siteNav-logo u-fillTransparentBlackDarker u-flex0 u-flexCenter u-paddingTop0"><span class="svgIcon svgIcon--logoMonogram svgIcon--45px is-flushLeft u-flex0 u-flexCenter u-paddingTop0"><svg class="svgIcon-use" width="45" height="45"><path d="M5 40V5h35v35H5zm8.56-12.627c0 .555-.027.687-.318 1.03l-2.457 2.985v.396h6.974v-.396l-2.456-2.985c-.291-.343-.344-.502-.344-1.03V18.42l6.127 13.364h.714l5.256-13.364v10.644c0 .29 0 .342-.185.528l-1.848 1.796v.396h9.19v-.396l-1.822-1.796c-.184-.186-.21-.238-.21-.528V15.937c0-.291.026-.344.21-.528l1.823-1.797v-.396h-6.471l-4.622 11.542-5.203-11.542h-6.79v.396l2.14 2.64c.239.292.291.37.291.768v10.353z"></path></svg></span><span class="u-textScreenReader">Homepage</span></a></div><div class="u-xs-show js-metabarLogoLeft"><a href="https://medium.com/" data-log-event="home" class="siteNav-logo u-fillTransparentBlackDarker u-flex0 u-flexCenter u-paddingTop0"><span class="svgIcon svgIcon--logoMonogram svgIcon--45px is-flushLeft u-flex0 u-flexCenter u-paddingTop0"><svg class="svgIcon-use" width="45" height="45"><path d="M5 40V5h35v35H5zm8.56-12.627c0 .555-.027.687-.318 1.03l-2.457 2.985v.396h6.974v-.396l-2.456-2.985c-.291-.343-.344-.502-.344-1.03V18.42l6.127 13.364h.714l5.256-13.364v10.644c0 .29 0 .342-.185.528l-1.848 1.796v.396h9.19v-.396l-1.822-1.796c-.184-.186-.21-.238-.21-.528V15.937c0-.291.026-.344.21-.528l1.823-1.797v-.396h-6.471l-4.622 11.542-5.203-11.542h-6.79v.396l2.14 2.64c.239.292.291.37.291.768v10.353z"></path></svg></span><span class="u-textScreenReader">Homepage</span></a></div></div><div class="metabar-block u-flex0"><div class="buttonSet buttonSet--wide"><a class="button button--chromeless u-baseColor--buttonNormal u-xs-hide js-upgradeMembershipAction" href="https://medium.com/membership?source=upgrade_membership---nav_full">Become a member</a><a class="button button--primary button--chromeless u-accentColor--buttonNormal is-inSiteNavBar u-xs-hide js-signInButton" href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%2F%40evnsio%2Fmanaging-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a&amp;source=--------------------------nav_reg&amp;operation=login" data-action="sign-in-prompt" data-redirect="https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a" data-action-source="--------------------------nav_reg">Sign in</a><a class="button button--primary button--withChrome u-accentColor--buttonNormal is-inSiteNavBar js-signUpButton" href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%2F%40evnsio%2Fmanaging-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a&amp;source=--------------------------nav_reg&amp;operation=register" data-action="sign-up-prompt" data-redirect="https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a" data-action-source="--------------------------nav_reg">Get started</a></div></div></div></div><div class="metabar metabar--spacer js-metabarSpacer u-height65 u-xs-height56"></div><main role="main"><article class=" u-minHeight100vhOffset65 u-overflowHidden postArticle postArticle--full u-marginBottom40" lang="en"><div class="postArticle-content js-postField js-notesSource js-trackPostScrolls" data-post-id="d0330effea9a" data-source="post_page" data-tracking-context="postPage"><section name="96bf" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h1 name="8426" id="8426" class="graf graf--h3 graf--leading graf--title">Managing my Home with Kubernetes, Traefik, and Raspberry Pi’s</h1><div class="uiScale uiScale-ui--regular uiScale-caption--regular u-flexCenter u-marginVertical24 u-fontSize15 js-postMetaLockup"><div class="u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@evnsio?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="da7f46287a8" data-action-type="hover" data-user-id="da7f46287a8" dir="auto"><img src="Managing%20my%20Home%20with%20Kubernetes,%20Traefik,%20and%20Raspberry%20Pi%E2%80%99s_files/0coXb8TrcEf08KJ0d_002.jpg" class="avatar-image u-size50x50" alt="Go to the profile of Chris Evans"></a></div><div class="u-flex1 u-paddingLeft15 u-overflowHidden"><div class="u-paddingBottom3"><a class="ds-link ds-link--styleSubtle ui-captionStrong u-inlineBlock link link--darken link--darker" href="https://medium.com/@evnsio" data-action="show-user-card" data-action-value="da7f46287a8" data-action-type="hover" data-user-id="da7f46287a8" dir="auto">Chris Evans</a><span class="followState js-followState" data-user-id="da7f46287a8"><button class="button button--smallest u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton u-marginLeft10 u-xs-hide" data-action="sign-up-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-redirect="https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a" data-action-source="post_header_lockup"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--smallest button--dark u-noUserSelect button--withChrome u-accentColor--buttonDark button--follow js-followButton u-marginLeft10 u-xs-hide" data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/da7f46287a8" data-action-source="post_header_lockup-da7f46287a8-------------------------follow_byline"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="ui-caption postMetaInline js-testPostMetaInlineSupplemental"><time datetime="2018-01-16T11:37:26.481Z">Jan 16, 2018</time><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="6 min read"></span></div></div></div><p name="c8e5" id="c8e5" class="graf graf--p graf-after--h3">I recently bought some <a href="http://sonoff.itead.cc/en/products/sonoff/sonoff-basic" data-href="http://sonoff.itead.cc/en/products/sonoff/sonoff-basic" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Wifi enabled smart switches</a>
 to allow me to control some table lamps at home. They’re great: super 
cheap in comparison to some other offerings, simple to setup, and they 
work well with Google Assistant and and my Google Home. The problem is 
that they depend on an external server to work properly, and the 
reliability of that service has been <a href="https://www.itead.cc/blog/explanation-on-service-disruption-on-eu-region" data-href="https://www.itead.cc/blog/explanation-on-service-disruption-on-eu-region" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">pretty poor</a>.</p><p name="5a30" id="5a30" class="graf graf--p graf-after--p">Handily there’s an open source <a href="https://github.com/arendst/Sonoff-Tasmota/" data-href="https://github.com/arendst/Sonoff-Tasmota/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">project</a>
 providing custom firmware for these devices, so I decided to dust off 
my soldering iron and flash the devices (this warrants a whole article 
in itself — one for the future 😉). With the devices under my control I 
needed somewhere to run the software stack to manage them, so set to 
work on a couple of spare Raspberry Pi’s I had to hand.</p><p name="1a1f" id="1a1f" class="graf graf--p graf-after--p">I had a few requirements:</p><ul class="postList"><li name="780b" id="780b" class="graf graf--li graf-after--p">I wanted to run a home automation platform with Android App support, and had chosen (semi-arbitrarily) Home Assistant.</li><li name="ed30" id="ed30" class="graf graf--li graf-after--li">I wanted the web interface to be accessible outside of my home, so I could check and manage devices while away.</li><li name="9b66" id="9b66" class="graf graf--li graf-after--li">I wanted my Google Home to be able to control the devices, which required me to have an external HTTPS endpoint.</li><li name="3749" id="3749" class="graf graf--li graf-after--li">I needed to manage dynamic DNS, since I don’t have a static IP.</li></ul><p name="2a14" id="2a14" class="graf graf--p graf-after--li">Whilst
 I could have run all these natively on a single Raspberry Pi, I decided
 instead to use Docker to keep things well isolated and easy to reason 
about. Moreover, I didn’t want to spend hours working over SSH so 
settled on Kubernetes for a more API driven deployment approach.</p><p name="d6f3" id="d6f3" class="graf graf--p graf-after--p">In this post, I’ll walk through the steps I took to setup the core platform. Specifically this includes:</p><ul class="postList"><li name="c30d" id="c30d" class="graf graf--li graf-after--p">Setting up a master + single node Kubernetes cluster</li><li name="f00c" id="f00c" class="graf graf--li graf-after--li">Deploying my DNS updater as a Kubernetes CronJob object.</li><li name="eccc" id="eccc" class="graf graf--li graf-after--li">Deploying Traefik as a Kubernetes Ingress Controller, and configuring it to manage SSL with Let’s Encrypt.</li></ul><figure name="825f" id="825f" class="graf graf--figure graf-after--li graf--trailing"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 432px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 61.7%;"></div><div class="progressiveMedia js-progressiveMedia graf-image" data-image-id="1*5EE7y57XvUKdmfvA0pCkRQ.png" data-width="988" data-height="610" data-is-featured="true" data-action="zoom" data-action-value="1*5EE7y57XvUKdmfvA0pCkRQ.png"><img src="Managing%20my%20Home%20with%20Kubernetes,%20Traefik,%20and%20Raspberry%20Pi%E2%80%99s_files/15EE7y57XvUKdmfvA0pCkRQ_002.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/1600/1*5EE7y57XvUKdmfvA0pCkRQ.png"><span><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="Managing%20my%20Home%20with%20Kubernetes,%20Traefik,%20and%20Raspberry%20Pi%E2%80%99s_files/15EE7y57XvUKdmfvA0pCkRQ.png"></span></div></div></figure></div></div></section><section name="0b8b" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="7e59" id="7e59" class="graf graf--h4 graf--leading">Setting up a Pi Kubernetes Cluster</h4><p name="74a1" id="74a1" class="graf graf--p graf-after--h4">I claim no credit for this part, and simply copied the excellent guide written by Alex Ellis <a href="https://gist.github.com/alexellis/fdbc90de7691a1b9edb545c17da2d975" data-href="https://gist.github.com/alexellis/fdbc90de7691a1b9edb545c17da2d975" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">here</a>. I pretty much followed it to the letter, using <code class="markup--code markup--p-code">kubeadm</code> to initialise a cluster on the master and then join in my single node.</p><pre name="bc1b" id="bc1b" class="graf graf--pre graf-after--p">$ kubectl get nodes</pre><pre name="395d" id="395d" class="graf graf--pre graf-after--pre">NAME         STATUS    ROLES     AGE       VERSION<br>k8s-master   Ready     master    2d        v1.9.1<br>k8s-node-1   Ready     &lt;none&gt;    2d        v1.9.1</pre><p name="ae13" id="ae13" class="graf graf--p graf-after--pre">Big thanks to Alex for sharing his guide 👏</p><h4 name="4330" id="4330" class="graf graf--h4 graf-after--p">DNS and&nbsp;Routing</h4><p name="288c" id="288c" class="graf graf--p graf-after--h4">To
 satisfy the need for external access and provide a stable endpoint for 
my dynamic IP, I needed something to periodically update a DNS record to
 the right address. I use Cloudflare to manage DNS for my website, so 
decided to use a subdomain for things running at home.</p><p name="cc20" id="cc20" class="graf graf--p graf-after--p">I wrote a simple (read hacky) bash script to do the Cloudflare update, deployed it into Kubernetes as a <code class="markup--code markup--p-code">ConfigMap</code>, and mounted it as a volume in a <code class="markup--code markup--p-code">CronJob</code> object set to run every 15 mins:</p><pre name="71c0" id="71c0" class="graf graf--pre graf-after--p">apiVersion: batch/v1beta1<br>kind: CronJob<br>metadata:<br>  name: dns-update<br>  namespace: k8s-home<br>spec:<br>  schedule: "*/15 * * * *"<br>  concurrencyPolicy: Forbid<br>  jobTemplate:<br>    spec:<br>      template:<br>        spec:<br>          containers:<br>          - name: dns-update<br>            image: evns/rpi-utilities<br>            command: [ "/bin/sh", "-c", "chmod +x /scripts/update.sh &amp;&amp; /scripts/update.sh" ]<br>            env:<br>            - name: RECORD_NAME<br>              valueFrom:<br>                secretKeyRef:<br>                  name: cloudflare<br>                  key: record_name<br>            - name: API_KEY<br>              valueFrom:<br>                secretKeyRef:<br>                  name: cloudflare<br>                  key: api_key<br>            ...<br>            volumeMounts:<br>            - name: config-volume<br>              mountPath: /scripts<br>          volumes:<br>          - name: config-volume<br>            configMap:<br>              name: update-script</pre><p name="3f9e" id="3f9e" class="graf graf--p graf-after--pre">At this point I had a DNS entry <code class="markup--code markup--p-code">*.home.evns.io</code> pointed at my dynamic public IP 👌</p><p name="3df7" id="3df7" class="graf graf--p graf-after--p">To
 pave the way for running web applications, I knew I’d need to open at 
least ports 80 and 443 on my router’s firewall, and since the 
destination would be a container running on my Kubernetes node I 
configured the ports to forward to that IP. Obviously, at this stage 
there was nothing running there so I wasn’t expecting any kind of 
response.</p><h4 name="f0cc" id="f0cc" class="graf graf--h4 graf-after--p">Traefik and Let’s&nbsp;Encrypt</h4><p name="7236" id="7236" class="graf graf--p graf-after--h4">With
 a functioning cluster, and the networking setup complete, the next task
 was to deploy a reverse proxy to manage the application routing. In 
Kubernetes we can deploy an <a href="https://medium.com/@cashisclay/kubernetes-ingress-82aa960f658e" data-href="https://medium.com/@cashisclay/kubernetes-ingress-82aa960f658e" class="markup--anchor markup--p-anchor" target="_blank">Ingress Controller</a> to achieve this. An Ingress Controller is an implementation of a reverse proxy which listens for changes to Kubernetes<code class="markup--code markup--p-code">Ingress</code>
 resources and updates it’s configuration accordingly. I’ve previously 
used Nginx for this purpose, but having heard good things about Traefik 
decided to give it a whirl.</p><p name="2356" id="2356" class="graf graf--p graf-after--p">Traefik provide detailed <a href="https://docs.traefik.io/user-guide/kubernetes/" data-href="https://docs.traefik.io/user-guide/kubernetes/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">instructions</a> to get their implementation running, but I had to customise it slightly to get things working with my setup.</p><p name="c423" id="c423" class="graf graf--p graf-after--p">First,
 since I wanted all communication over HTTPS, I modified the config to 
force anything on HTTP over to the secure entrypoint. This was as simple
 as adding the following to the config file:</p><pre name="6bff" id="6bff" class="graf graf--pre graf-after--p"># Force HTTPS<br>[entryPoints]<br>  [entryPoints.http]<br>  address = ":80"<br>    [entryPoints.http.redirect]<br>    entryPoint = "https"<br>  [entryPoints.https]<br>  address = ":443"<br>    [entryPoints.https.tls]</pre><p name="4f09" id="4f09" class="graf graf--p graf-after--pre">To
 support the HTTPS endpoints, I also needed to configure Let’s Encrypt 
to enable it to automatically fetch certificates. Having Let’s Encrypt 
as a built capability is one of the areas where Traefik excels. In 
previous Kubernetes configurations I’ve had to deploy a separate 
application like <a href="https://github.com/jetstack/kube-lego" data-href="https://github.com/jetstack/kube-lego" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">kube-lego</a>
 to handle the certificate generation, so having it built in is a big 
positive. I used Cloudflare as the DNS provider which configures Traefik
 to use DNS records for domain validation.</p><pre name="ac50" id="ac50" class="graf graf--pre graf-after--p"># Let's encrypt configuration<br>[acme]<br>  email="&lt;my-email&gt;"<br>  storage="/etc/traefik/acme.json"<br>  entryPoint="https"<br>  acmeLogging=true<br>  onDemand=true<br>  onHostRule=true<br>  dnsProvider="cloudflare"</pre><p name="8f13" id="8f13" class="graf graf--p graf-after--pre">Next I updated the <code class="markup--code markup--p-code">Deployment</code>
 to use the new config, and also to store the Let’s Encrypt state on the
 host to ensure persistence in the event of the container being updated.
 One issue I had here was that the file created by Traefik had the wrong
 permissions set; Kubernetes creates the file on the host with 755 which
 Traefik deems overly permissive, expecting only 600. In the interest of
 getting things working, I’ve deferred the investigation into this and 
simply changed the permission manually on the host. The final change was
 to provide the Cloudflare credentials to enable control of my DNS zone.</p><pre name="0441" id="0441" class="graf graf--pre graf-after--p">kind: Deployment<br>apiVersion: extensions/v1beta1<br>metadata:<br>  name: traefik-ingress-controller<br>  namespace: kube-system<br>spec:<br>  replicas: 1<br>  selector:<br>    matchLabels:<br>      k8s-app: traefik-ingress-lb<br>  template:<br>    metadata:<br>      labels:<br>        name: traefik-ingress-lb<br>    spec:<br>      serviceAccountName: traefik-ingress-controller<br>      terminationGracePeriodSeconds: 60<br>      containers:<br>      - image: traefik:v1.5<br>        name: traefik-ingress-lb<br>        env:<br>          - name: CLOUDFLARE_EMAIL<br>            valueFrom:<br>              secretKeyRef:<br>                name: cloudflare<br>                key: email<br>          - name: CLOUDFLARE_API_KEY<br>            valueFrom:<br>              secretKeyRef:<br>                name: cloudflare<br>                key: api_key<br>        volumeMounts:<br>          - mountPath: "/config"<br>            name: "config"<br>          - mountPath: "/etc/traefik/acme.json"<br>            name: "acme"<br>        args:<br>          - --configfile=/config/traefik.toml<br>      volumes:<br>        - name: config<br>          configMap:<br>            name: traefik-config<br>        - name: acme<br>          hostPath:<br>            type: FileOrCreate<br>            path: /etc/traefik/acme.json</pre><p name="2852" id="2852" class="graf graf--p graf-after--pre">The final change was to edit the Traefik <code class="markup--code markup--p-code">Service</code>
 to allow external access into the cluster. By default it exposes ports 
80 and 443 to other services in the cluster, as is the nature with a 
service of type <code class="markup--code markup--p-code">ClusterIP</code>. In a cloud installation it’s common to change to the service type to <code class="markup--code markup--p-code">LoadBalancer</code>,
 which would provision an external load balancer with a stable IP/DNS 
address, but since I have no load balancers in my Pi setup and only one 
node, I instead updated the service definition to include an externalIP.
 This essentially binds ports 80 and 443 on the host interface to ensure
 all traffic is routed to Pods running Traefik.</p><pre name="8595" id="8595" class="graf graf--pre graf-after--p">kind: Service<br>apiVersion: v1<br>metadata:<br>  name: traefik-ingress-service<br>  namespace: kube-system<br>spec:<br>  selector:<br>    k8s-app: traefik-ingress-lb<br>  ports:<br>    - protocol: TCP<br>      port: 80<br>      name: http<br>    - protocol: TCP<br>      port: 443<br>      name: https<br>  externalIPs:<br>    - 192.168.0.101 # This is the node address</pre><p name="0ef5" id="0ef5" class="graf graf--p graf-after--pre">With all this in place, I deployed a <code class="markup--code markup--p-code">Service</code> and <code class="markup--code markup--p-code">Ingress</code>
 for the Traefik dashboard, and sat back while it automatically 
configured the routing and SSL certs 😎 The result is a secure site 
accessible on the internet as can be seen here 👇</p><figure name="ee4b" id="ee4b" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 396px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.599999999999994%;"></div><div class="progressiveMedia js-progressiveMedia graf-image" data-image-id="1*X9xupOkHICAThl9R2gPmzw.png" data-width="1108" data-height="627" data-action="zoom" data-action-value="1*X9xupOkHICAThl9R2gPmzw.png"><img src="Managing%20my%20Home%20with%20Kubernetes,%20Traefik,%20and%20Raspberry%20Pi%E2%80%99s_files/1X9xupOkHICAThl9R2gPmzw_002.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/1600/1*X9xupOkHICAThl9R2gPmzw.png"><span><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="Managing%20my%20Home%20with%20Kubernetes,%20Traefik,%20and%20Raspberry%20Pi%E2%80%99s_files/1X9xupOkHICAThl9R2gPmzw.png"></span></div></div></figure><h4 name="249a" id="249a" class="graf graf--h4 graf-after--figure">PiVPN</h4><p name="2d6f" id="2d6f" class="graf graf--p graf-after--h4 graf--trailing">Whilst
 not an original requirement, I also decided to deploy a VPN solution so
 could manage everything whilst away from home. I used PiVPN to deploy 
an OpenVPN server on the master. The instructions <a href="http://www.pivpn.io/" data-href="http://www.pivpn.io/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">here</a> provided everything I needed to get it working.</p></div></div></section><section name="0d9d" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="40e8" id="40e8" class="graf graf--h4 graf--leading">Bringing it all&nbsp;Together</h4><p name="c35e" id="c35e" class="graf graf--p graf-after--h4">My home setup now looks roughly like this:</p><figure name="533f" id="533f" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 426px; max-height: 461px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 108.2%;"></div><div class="progressiveMedia js-progressiveMedia graf-image" data-image-id="1*6M9G1DeawV-ctdbduVaZNg.png" data-width="426" data-height="461"><img src="Managing%20my%20Home%20with%20Kubernetes,%20Traefik,%20and%20Raspberry%20Pi%E2%80%99s_files/16M9G1DeawV-ctdbduVaZNg_002.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/1600/1*6M9G1DeawV-ctdbduVaZNg.png"><span><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="Managing%20my%20Home%20with%20Kubernetes,%20Traefik,%20and%20Raspberry%20Pi%E2%80%99s_files/16M9G1DeawV-ctdbduVaZNg.png"></span></div></div></figure><p name="5e63" id="5e63" class="graf graf--p graf-after--figure">I
 have a cluster which I can manage from anywhere, and the ability to run
 and expose applications over HTTPS using only Kubernetes resources. Is 
it over engineered for a home solution? Probably. But I’ve now got 
something super flexible which I can use to for running apps in my home,
 and more importantly I got to play with some interesting tech along the
 way.</p><h4 name="d1dc" id="d1dc" class="graf graf--h4 graf-after--p">What’s next?</h4><p name="2910" id="2910" class="graf graf--p graf-after--h4 graf--trailing">The
 astute among you will notice I haven’t discussed the Home Automation 
side of things. I’ll post something on this over the next few weeks.</p></div></div></section></div><footer class="u-paddingTop10"><div class="container u-maxWidth740"><div class="row"><div class="col u-size12of12"></div></div><div class="row"><div class="col u-size12of12 js-postTags"><div class="u-paddingBottom10"><ul class="tags tags--postTags tags--borderless"><li><a class="link u-baseColor--link" href="https://medium.com/tag/kubernetes?source=post" data-action-source="post">Kubernetes</a></li><li><a class="link u-baseColor--link" href="https://medium.com/tag/traefik?source=post" data-action-source="post">Traefik</a></li><li><a class="link u-baseColor--link" href="https://medium.com/tag/raspberry-pi?source=post" data-action-source="post">Raspberry Pi</a></li><li><a class="link u-baseColor--link" href="https://medium.com/tag/home-automation?source=post" data-action-source="post">Home Automation</a></li><li><a class="link u-baseColor--link" href="https://medium.com/tag/smart-home?source=post" data-action-source="post">Smart Home</a></li></ul></div></div></div><div class="postActions js-postActionsFooter "><div class="u-flexCenter"><div class="u-flex1"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="d0330effea9a" data-is-icon-29px="true" data-is-circle="true" data-has-recommend-list="true" data-source="post_actions_footer-----d0330effea9a---------------------clap_footer" data-clap-string-singular="clap" data-clap-string-plural="claps"><div class="u-relative u-foreground"><button class="button button--large button--circle button--withChrome u-baseColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton clapButton--darker clapButton--largePill u-relative u-foreground u-xs-paddingLeft13 u-width60 u-height60 u-accentColor--textNormal u-accentColor--buttonNormal clap-onboarding" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/d0330effea9a" data-action-source="post_actions_footer-----d0330effea9a---------------------clap_footer" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33"><path d="M28.86 17.342l-3.64-6.402c-.292-.433-.712-.729-1.163-.8a1.124 1.124 0 0 0-.889.213c-.63.488-.742 1.181-.33 2.061l1.222 2.587 1.4 2.46c2.234 4.085 1.511 8.007-2.145 11.663-.26.26-.526.49-.797.707 1.42-.084 2.881-.683 4.292-2.094 3.822-3.823 3.565-7.876 2.05-10.395zm-6.252 11.075c3.352-3.35 3.998-6.775 1.978-10.469l-3.378-5.945c-.292-.432-.712-.728-1.163-.8a1.122 1.122 0 0 0-.89.213c-.63.49-.742 1.182-.33 2.061l1.72 3.638a.502.502 0 0 1-.806.568l-8.91-8.91a1.335 1.335 0 0 0-1.887 1.886l5.292 5.292a.5.5 0 0 1-.707.707l-5.292-5.292-1.492-1.492c-.503-.503-1.382-.505-1.887 0a1.337 1.337 0 0 0 0 1.886l1.493 1.492 5.292 5.292a.499.499 0 0 1-.353.854.5.5 0 0 1-.354-.147L5.642 13.96a1.338 1.338 0 0 0-1.887 0 1.338 1.338 0 0 0 0 1.887l2.23 2.228 3.322 3.324a.499.499 0 0 1-.353.853.502.502 0 0 1-.354-.146l-3.323-3.324a1.333 1.333 0 0 0-1.886 0 1.325 1.325 0 0 0-.39.943c0 .356.138.691.39.943l6.396 6.397c3.528 3.53 8.86 5.313 12.821 1.353zM12.73 9.26l5.68 5.68-.49-1.037c-.518-1.107-.426-2.13.224-2.89l-3.303-3.304a1.337 1.337 0 0 0-1.886 0 1.326 1.326 0 0 0-.39.944c0 .217.067.42.165.607zm14.787 19.184c-1.599 1.6-3.417 2.392-5.353 2.392-.349 0-.7-.03-1.058-.082a7.922 7.922 0 0 1-3.667.887c-3.049 0-6.115-1.626-8.359-3.87l-6.396-6.397A2.315 2.315 0 0 1 2 19.724a2.327 2.327 0 0 1 1.923-2.296l-.875-.875a2.339 2.339 0 0 1 0-3.3 2.33 2.33 0 0 1 1.24-.647l-.139-.139c-.91-.91-.91-2.39 0-3.3.884-.884 2.421-.882 3.301 0l.138.14a2.335 2.335 0 0 1 3.948-1.24l.093.092c.091-.423.291-.828.62-1.157a2.336 2.336 0 0 1 3.3 0l3.384 3.386a2.167 2.167 0 0 1 1.271-.173c.534.086 1.03.354 1.441.765.11-.549.415-1.034.911-1.418a2.12 2.12 0 0 1 1.661-.41c.727.117 1.385.565 1.853 1.262l3.652 6.423c1.704 2.832 2.025 7.377-2.205 11.607zM13.217.484l-1.917.882 2.37 2.837-.454-3.719zm8.487.877l-1.928-.86-.44 3.697 2.368-2.837zM16.5 3.293L15.478-.005h2.044L16.5 3.293z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33"><g fill-rule="evenodd"><path d="M29.58 17.1l-3.854-6.78c-.365-.543-.876-.899-1.431-.989a1.491 1.491 0 0 0-1.16.281c-.42.327-.65.736-.7 1.207v.001l3.623 6.367c2.46 4.498 1.67 8.802-2.333 12.807-.265.265-.536.505-.81.728 1.973-.222 3.474-1.286 4.45-2.263 4.166-4.165 3.875-8.6 2.215-11.36zm-4.831.82l-3.581-6.3c-.296-.439-.725-.742-1.183-.815a1.105 1.105 0 0 0-.89.213c-.647.502-.755 1.188-.33 2.098l1.825 3.858a.601.601 0 0 1-.197.747.596.596 0 0 1-.77-.067L10.178 8.21c-.508-.506-1.393-.506-1.901 0a1.335 1.335 0 0 0-.393.95c0 .36.139.698.393.95v.001l5.61 5.61a.599.599 0 1 1-.848.847l-5.606-5.606c-.001 0-.002 0-.003-.002L5.848 9.375a1.349 1.349 0 0 0-1.902 0 1.348 1.348 0 0 0 0 1.901l1.582 1.582 5.61 5.61a.6.6 0 0 1-.848.848l-5.61-5.61c-.51-.508-1.393-.508-1.9 0a1.332 1.332 0 0 0-.394.95c0 .36.139.697.393.952l2.363 2.362c.002.001.002.002.002.003l3.52 3.52a.6.6 0 0 1-.848.847l-3.522-3.523h-.001a1.336 1.336 0 0 0-.95-.393 1.345 1.345 0 0 0-.949 2.295l6.779 6.78c3.715 3.713 9.327 5.598 13.49 1.434 3.527-3.528 4.21-7.13 2.086-11.015zM11.817 7.727c.06-.328.213-.64.466-.893.64-.64 1.755-.64 2.396 0l3.232 3.232c-.82.783-1.09 1.833-.764 2.992l-5.33-5.33z"></path><path d="M13.285.48l-1.916.881 2.37 2.837z"></path><path d="M21.719 1.361L19.79.501l-.44 3.697z"></path><path d="M16.502 3.298L15.481 0h2.043z"></path></g></svg></span></span></button><div class="clapUndo u-width60 u-round u-height32 u-absolute u-borderBox u-paddingRight5 u-transition--transform200Springu-backgroundGrayLighter js-clapUndo" style="top: 14px; padding: 2px;"><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon u-floatRight" data-action="multivote-undo" data-action-value="d0330effea9a"><span class="svgIcon svgIcon--removeThin svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M20.13 8.11l-5.61 5.61-5.609-5.61-.801.801 5.61 5.61-5.61 5.61.801.8 5.61-5.609 5.61 5.61.8-.801-5.609-5.61 5.61-5.61" fill-rule="evenodd"></path></svg></span></button></div></div><span class="u-relative u-background js-actionMultirecommendCount u-marginLeft16"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton u-textColorDarker" data-action="show-recommends" data-action-value="d0330effea9a">155 claps</button><span class="u-xs-hide"></span></span></div></div><div class="buttonSet u-flex0"><a class="button button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon button--dark button--chromeless u-xs-hide u-marginRight12" href="https://medium.com/p/d0330effea9a/share/twitter" title="Share on Twitter" aria-label="Share on Twitter" target="_blank" data-action-source="post_actions_footer"><span class="button-defaultState"><span class="svgIcon svgIcon--twitterFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M22.053 7.54a4.474 4.474 0 0 0-3.31-1.455 4.526 4.526 0 0 0-4.526 4.524c0 .35.04.7.082 1.05a12.9 12.9 0 0 1-9.3-4.77c-.39.69-.61 1.46-.65 2.26.03 1.6.83 2.99 2.02 3.79-.72-.02-1.41-.22-2.02-.57-.01.02-.01.04 0 .08-.01 2.17 1.55 4 3.63 4.44-.39.08-.79.13-1.21.16-.28-.03-.57-.05-.81-.08.54 1.77 2.21 3.08 4.2 3.15a9.564 9.564 0 0 1-5.66 1.94c-.34-.03-.7-.06-1.05-.08 2 1.27 4.38 2.02 6.94 2.02 8.31 0 12.86-6.9 12.84-12.85.02-.24.01-.43 0-.65.89-.62 1.65-1.42 2.26-2.34-.82.38-1.69.62-2.59.72a4.37 4.37 0 0 0 1.94-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></span></span></a><a class="button button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon button--dark button--chromeless u-xs-hide u-marginRight12" href="https://medium.com/p/d0330effea9a/share/facebook" title="Share on Facebook" aria-label="Share on Facebook" target="_blank" data-action-source="post_actions_footer"><span class="button-defaultState"><span class="svgIcon svgIcon--facebookSquare svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M23.209 5H5.792A.792.792 0 0 0 5 5.791V23.21c0 .437.354.791.792.791h9.303v-7.125H12.72v-2.968h2.375v-2.375c0-2.455 1.553-3.662 3.741-3.662 1.049 0 1.95.078 2.213.112v2.565h-1.517c-1.192 0-1.469.567-1.469 1.397v1.963h2.969l-.594 2.968h-2.375L18.11 24h5.099a.791.791 0 0 0 .791-.791V5.79a.791.791 0 0 0-.791-.79"></path></svg></span></span></a><button class="button button--large button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon u-xs-show u-marginRight10" title="Share this story on Twitter or Facebook" aria-label="Share this story on Twitter or Facebook" data-action="show-share-popover" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--share svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M20.385 8H19a.5.5 0 1 0 .011 1h1.39c.43 0 .84.168 1.14.473.31.305.48.71.48 1.142v10.77c0 .43-.17.837-.47 1.142-.3.305-.71.473-1.14.473H8.62c-.43 0-.84-.168-1.144-.473a1.603 1.603 0 0 1-.473-1.142v-10.77c0-.43.17-.837.48-1.142A1.599 1.599 0 0 1 8.62 9H10a.502.502 0 0 0 0-1H8.615c-.67 0-1.338.255-1.85.766-.51.51-.765 1.18-.765 1.85v10.77c0 .668.255 1.337.766 1.848.51.51 1.18.766 1.85.766h11.77c.668 0 1.337-.255 1.848-.766.51-.51.766-1.18.766-1.85v-10.77c0-.668-.255-1.337-.766-1.848A2.61 2.61 0 0 0 20.384 8zm-8.67-2.508L14 3.207v8.362c0 .27.224.5.5.5s.5-.23.5-.5V3.2l2.285 2.285a.49.49 0 0 0 .704-.001.511.511 0 0 0 0-.708l-3.14-3.14a.504.504 0 0 0-.71 0L11 4.776a.501.501 0 0 0 .71.706" fill-rule="evenodd"></path></svg></span></button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon" data-action="scroll-to-responses" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--response svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M21.27 20.058c1.89-1.826 2.754-4.17 2.754-6.674C24.024 8.21 19.67 4 14.1 4 8.53 4 4 8.21 4 13.384c0 5.175 4.53 9.385 10.1 9.385 1.007 0 2-.14 2.95-.41.285.25.592.49.918.7 1.306.87 2.716 1.31 4.19 1.31.276-.01.494-.14.6-.36a.625.625 0 0 0-.052-.65c-.61-.84-1.042-1.71-1.282-2.58a5.417 5.417 0 0 1-.154-.75zm-3.85 1.324l-.083-.28-.388.12a9.72 9.72 0 0 1-2.85.424c-4.96 0-8.99-3.706-8.99-8.262 0-4.556 4.03-8.263 8.99-8.263 4.95 0 8.77 3.71 8.77 8.27 0 2.25-.75 4.35-2.5 5.92l-.24.21v.32c0 .07 0 .19.02.37.03.29.1.6.19.92.19.7.49 1.4.89 2.08-.93-.14-1.83-.49-2.67-1.06-.34-.22-.88-.48-1.16-.74z"></path></svg></span></button><button class="button button--chromeless u-baseColor--buttonNormal u-marginRight12" data-action="scroll-to-responses">1</button><button class="button button--large button--dark button--chromeless is-touchIconFadeInPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/d0330effea9a" data-action-source="post_actions_footer"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--29px u-marginRight4"><svg class="svgIcon-use" width="29" height="29"><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4zM21 23l-5.91-3.955-.148-.107a.751.751 0 0 0-.884 0l-.147.107L8 23V6.615C8 5.725 8.725 5 9.615 5h9.77C20.275 5 21 5.725 21 6.615V23z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--29px u-marginRight4"><svg class="svgIcon-use" width="29" height="29"><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4z" fill-rule="evenodd"></path></svg></span></span></button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon js-moreActionsButton" title="More actions" aria-label="More actions" data-action="more-actions"><span class="svgIcon svgIcon--more svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="-480.5 272.5 21 21"><path d="M-463 284.6c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5z"></path></svg></span></button></div></div></div></div><div class="u-maxWidth740 u-paddingTop20 u-marginTop20 u-borderTopLightest container u-paddingBottom20 u-xs-paddingBottom10 js-postAttributionFooterContainer"><div class="row js-postFooterInfo"><div class="col u-size12of12"><li class="uiScale uiScale-ui--small uiScale-caption--regular u-block u-paddingBottom18 js-cardUser"><div class="u-marginLeft20 u-floatRight"><span class="followState js-followState" data-user-id="da7f46287a8"><button class="button button--small u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton" data-action="sign-up-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-redirect="https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a" data-action-source="footer_card"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--small u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton" data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/da7f46287a8" data-action-source="footer_card-da7f46287a8-------------------------follow_footer"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="u-tableCell"><a class="link u-baseColor--link avatar" href="https://medium.com/@evnsio?source=footer_card" title="Go to the profile of Chris Evans" aria-label="Go to the profile of Chris Evans" data-action-source="footer_card" data-user-id="da7f46287a8" dir="auto"><img src="Managing%20my%20Home%20with%20Kubernetes,%20Traefik,%20and%20Raspberry%20Pi%E2%80%99s_files/0coXb8TrcEf08KJ0d.jpg" class="avatar-image avatar-image--small" alt="Go to the profile of Chris Evans"></a></div><div class="u-tableCell u-verticalAlignMiddle u-breakWord u-paddingLeft15"><h3 class="ui-h3 u-fontSize18 u-lineHeightTighter u-marginBottom4"><a class="link link--primary u-accentColor--hoverTextNormal" href="https://medium.com/@evnsio" property="cc:attributionName" title="Go to the profile of Chris Evans" aria-label="Go to the profile of Chris Evans" rel="author cc:attributionUrl" data-user-id="da7f46287a8" dir="auto">Chris Evans</a></h3><p class="ui-body u-fontSize14 u-lineHeightBaseSans u-textColorDark u-marginBottom4">Platform Team Lead <a href="http://twitter.com/monzo" target="_blank" title="Twitter profile for @monzo">@monzo</a></p></div></li></div></div></div><div class="js-postFooterPlacements"></div><div class="u-padding0 u-clearfix u-backgroundGrayLightest u-print-hide supplementalPostContent js-responsesWrapper"></div><div class="supplementalPostContent js-heroPromo"></div></footer></article></main><aside class="u-marginAuto u-maxWidth1000 js-postLeftSidebar"><div class="u-foreground u-top0 u-transition--fadeOut300 u-fixed u-sm-hide js-postShareWidget"><ul><li class="u-marginVertical10"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="d0330effea9a" data-is-icon-29px="true" data-has-recommend-list="true" data-source="post_share_widget-----d0330effea9a---------------------clap_sidebar"><div class="u-relative u-foreground"><button class="button button--primary button--large button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton clapButton--darker" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/d0330effea9a" data-action-source="post_share_widget-----d0330effea9a---------------------clap_sidebar" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><g fill-rule="evenodd"><path d="M13.739 1l.761 2.966L15.261 1z"></path><path d="M16.815 4.776l1.84-2.551-1.43-.471z"></path><path d="M10.378 2.224l1.84 2.551-.408-3.022z"></path><path d="M22.382 22.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L6.11 15.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L8.43 9.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L20.628 15c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM12.99 6.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><g fill-rule="evenodd"><path d="M13.738 1l.762 2.966L15.262 1z"></path><path d="M18.634 2.224l-1.432-.47-.408 3.022z"></path><path d="M11.79 1.754l-1.431.47 1.84 2.552z"></path><path d="M24.472 14.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M14.58 10.887c-.156-.83.096-1.569.692-2.142L12.78 6.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M17.812 10.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L9.2 7.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L7.046 9.54 5.802 8.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394l1.241 1.241 4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L4.89 11.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C21.74 20.8 22.271 18 20.62 14.982l-2.809-4.942z"></path></g></svg></span></span></button></div><span class="u-relative u-background js-actionMultirecommendCount u-marginLeft5"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton" data-action="show-recommends" data-action-value="d0330effea9a">155</button></span></div></li><li class="u-marginVertical10 u-marginLeft3"><button class="button button--large button--dark button--chromeless is-touchIconFadeInPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/d0330effea9a" data-action-source="post_share_widget-----d0330effea9a---------------------bookmark_sidebar"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4zM21 23l-5.91-3.955-.148-.107a.751.751 0 0 0-.884 0l-.147.107L8 23V6.615C8 5.725 8.725 5 9.615 5h9.77C20.275 5 21 5.725 21 6.615V23z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4z" fill-rule="evenodd"></path></svg></span></span></button></li><li class="u-marginVertical10 u-marginLeft3"><a class="button button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon button--dark button--chromeless" href="https://medium.com/p/d0330effea9a/share/twitter" title="Share on Twitter" aria-label="Share on Twitter" target="_blank" data-action-source="post_share_widget"><span class="button-defaultState"><span class="svgIcon svgIcon--twitterFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M22.053 7.54a4.474 4.474 0 0 0-3.31-1.455 4.526 4.526 0 0 0-4.526 4.524c0 .35.04.7.082 1.05a12.9 12.9 0 0 1-9.3-4.77c-.39.69-.61 1.46-.65 2.26.03 1.6.83 2.99 2.02 3.79-.72-.02-1.41-.22-2.02-.57-.01.02-.01.04 0 .08-.01 2.17 1.55 4 3.63 4.44-.39.08-.79.13-1.21.16-.28-.03-.57-.05-.81-.08.54 1.77 2.21 3.08 4.2 3.15a9.564 9.564 0 0 1-5.66 1.94c-.34-.03-.7-.06-1.05-.08 2 1.27 4.38 2.02 6.94 2.02 8.31 0 12.86-6.9 12.84-12.85.02-.24.01-.43 0-.65.89-.62 1.65-1.42 2.26-2.34-.82.38-1.69.62-2.59.72a4.37 4.37 0 0 0 1.94-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></span></span></a></li><li class="u-marginVertical10 u-marginLeft3"><a class="button button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon button--dark button--chromeless" href="https://medium.com/p/d0330effea9a/share/facebook" title="Share on Facebook" aria-label="Share on Facebook" target="_blank" data-action-source="post_share_widget"><span class="button-defaultState"><span class="svgIcon svgIcon--facebookSquare svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M23.209 5H5.792A.792.792 0 0 0 5 5.791V23.21c0 .437.354.791.792.791h9.303v-7.125H12.72v-2.968h2.375v-2.375c0-2.455 1.553-3.662 3.741-3.662 1.049 0 1.95.078 2.213.112v2.565h-1.517c-1.192 0-1.469.567-1.469 1.397v1.963h2.969l-.594 2.968h-2.375L18.11 24h5.099a.791.791 0 0 0 .791-.791V5.79a.791.791 0 0 0-.791-.79"></path></svg></span></span></a></li></ul></div></aside><div class="u-fixed u-bottom0 u-width100pct u-backgroundWhite u-boxShadowTop u-borderBox u-paddingTop10 u-paddingBottom10 u-zIndexMetabar u-xs-paddingLeft10 u-xs-paddingRight10 js-stickyFooter"><div class="u-maxWidth700 u-marginAuto u-flexCenter"><div class="u-fontSize16 u-flex1 u-flexCenter"><div class="u-flex0 u-inlineBlock u-paddingRight20 u-xs-paddingRight10"><a class="link u-baseColor--link avatar u-inline" href="https://medium.com/@evnsio" data-action="show-user-card" data-action-value="da7f46287a8" data-action-type="hover" data-user-id="da7f46287a8" dir="auto"><img src="Managing%20my%20Home%20with%20Kubernetes,%20Traefik,%20and%20Raspberry%20Pi%E2%80%99s_files/0coXb8TrcEf08KJ0d_003.jpg" class="avatar-image avatar-image--smaller" alt="Go to the profile of Chris Evans"></a></div><div class="u-flex1 u-inlineBlock"><div class="u-xs-hide">Never miss a story from<strong> Chris Evans</strong>, when you sign up for Medium. <a class="link u-baseColor--link link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@Medium/personalize-your-medium-experience-with-users-publications-tags-26a41ab1ee0c#.hx4zuv3mg" data-action-source="sticky_footer">Learn more</a></div><div class="u-xs-show">Never miss a story from<strong> Chris Evans</strong></div></div></div><div class="u-marginLeft50 u-xs-marginAuto"><span class="followState js-followState" data-user-id="da7f46287a8"><button class="button u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton u-uiTextSemibold u-textUppercase u-fontSize12" data-action="sign-up-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-redirect="https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a" data-action-source="sticky_footer"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary is-active u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton u-uiTextSemibold u-textUppercase u-fontSize12" data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/da7f46287a8" data-action-source="sticky_footer-da7f46287a8-------------------------follow_metabar"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Get updates</span></button></span></div></div></div></div></div></div><div class="loadingBar"></div><script>// <![CDATA[
window["obvInit"] = function (opt_embedded) {window["obvInit"]["embedded"] = opt_embedded; window["obvInit"]["ready"] = true;}
// ]]></script><script>// <![CDATA[
var GLOBALS = {"audioUrl":"https://d1fcbxp97j4nb2.cloudfront.net","baseUrl":"https://medium.com","buildLabel":"36335-9230ee1","currentUser":{"userId":"lo_dnt_D9pyRGgrk388","isVerified":false,"subscriberEmail":"","hasPastMemberships":false,"isEnrolledInHightower":false,"isEligibleForHightower":false,"hightowerLastLockedAt":0,"isWriterProgramEnrolled":false,"isWriterProgramInvited":false,"isWriterProgramOptedOut":false,"writerProgramVersion":0,"writerProgramEnrolledAt":0,"friendLinkOnboarding":0,"hasAdditionalUnlocks":false,"hasApiAccess":false},"currentUserHasUnverifiedEmail":false,"isAuthenticated":false,"isCurrentUserVerified":false,"language":"en-us","miroUrl":"https://cdn-images-1.medium.com","moduleUrls":{"base":"https://cdn-static-1.medium.com/_/fp/gen-js/main-base.bundle.G38t5rU3caDOHAge_48LTg.js","common-async":"https://cdn-static-1.medium.com/_/fp/gen-js/main-common-async.bundle.DjdRh35UbDorfMRJf1uM3w.js","hightower":"https://cdn-static-1.medium.com/_/fp/gen-js/main-hightower.bundle.Dz1nOYGXzvYsO3f_eU-UVw.js","home-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-home-screens.bundle.K802smwrt2EE2neNpc6yAw.js","misc-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-misc-screens.bundle.O3c4Fn3slQFKCNmloirCtA.js","notes":"https://cdn-static-1.medium.com/_/fp/gen-js/main-notes.bundle.01kM2YZAGlWJqm0Mt0VGMw.js","payments":"https://cdn-static-1.medium.com/_/fp/gen-js/main-payments.bundle.Cpi8ToMn3Si66jvUjhTUBw.js","posters":"https://cdn-static-1.medium.com/_/fp/gen-js/main-posters.bundle.CRXDDDjOypyid8ULGB9KYg.js","power-readers":"https://cdn-static-1.medium.com/_/fp/gen-js/main-power-readers.bundle.wsSP2eVH4veDChoCJZO8DA.js","pubs":"https://cdn-static-1.medium.com/_/fp/gen-js/main-pubs.bundle.DwaMFg84p9PJvmVZoVhPgw.js","stats":"https://cdn-static-1.medium.com/_/fp/gen-js/main-stats.bundle.T0Ip2pbBQ3xy51QpWiY1Ug.js"},"previewConfig":{"weightThreshold":1,"weightImageParagraph":0.51,"weightIframeParagraph":0.8,"weightTextParagraph":0.08,"weightEmptyParagraph":0,"weightP":0.003,"weightH":0.005,"weightBq":0.003,"minPTextLength":60,"truncateBoundaryChars":20,"detectTitle":true,"detectTitleLevThreshold":0.15},"productName":"Medium","supportsEdit":true,"termsUrl":"//medium.com/policy/9db0094a1e0f","textshotHost":"textshot.medium.com","transactionId":"1548622576644:f852ff042d4c","useragent":{"browser":"firefox","family":"firefox","os":"","version":60,"supportsDesktopEdit":true,"supportsInteract":true,"supportsView":true,"isMobile":false,"isTablet":false,"isNative":false,"supportsFileAPI":true,"isTier1":true,"clientVersion":"","unknownParagraphsBad":false,"clientChannel":"","supportsRealScrollEvents":true,"supportsVhUnits":true,"ruinsViewportSections":false,"supportsHtml5Video":true,"supportsMagicUnderlines":true,"isWebView":false,"isFacebookWebView":false,"supportsProgressiveMedia":true,"supportsPromotedPosts":true,"isBot":false,"isNativeIphone":false,"supportsCssVariables":true,"supportsVideoSections":true,"emojiSupportLevel":1,"isSearchBot":false,"isSyndicationBot":false,"isNativeAndroid":false,"supportsScrollableMetabar":true},"variants":{"allow_access":true,"allow_signup":true,"allow_test_auth":"disallow","signin_services":"twitter,facebook,google,email,google-fastidv,google-one-tap","signup_services":"twitter,facebook,google,email,google-fastidv,google-one-tap","google_sign_in_android":true,"reengagement_notification_duration":3,"browsable_stream_config_bucket":"curated-topics","enable_dedicated_series_tab_api_ios":true,"enable_post_import":true,"available_monthly_plan":"60e220181034","available_annual_plan":"2c754bcc2995","disable_ios_resume_reading_toast":true,"is_not_medium_subscriber":true,"glyph_font_set":"m2","enable_branding":true,"enable_branding_fonts":true,"enable_friend_link_onboarding":true,"max_premium_content_per_user_under_metering":3,"enable_automated_mission_control_triggers":true,"enable_top_stories_for_you":true,"enable_lite_profile":true,"enable_topic_lifecycle_email":true,"enable_marketing_emails":true,"enable_truncated_rss_for_tags_and_topics":true,"enable_parsely":true,"enable_branch_io":true,"enable_synchronous_parsely":true,"enable_ios_post_stats":true,"enable_lite_topics":true,"enable_lite_stories":true,"redis_read_write_splitting":true,"enable_tipalti_onboarding":true,"enable_annual_renewal_reminder_email":true,"enable_sift_integration":true,"enable_sift_science_webhook":true,"enable_janky_spam_rules":"users,posts","enable_new_collaborative_filtering_data":true,"android_rating_prompt_stories_read_threshold":2,"enable_gifting_flow":true,"stripe_v3":true,"enable_google_one_tap":true,"enable_email_sign_in_captcha":true,"enable_social_shares_in_new_tab":true,"enable_sharing_is_caring":true,"enable_primary_topic_for_mobile":true},"xsrfToken":"","iosAppId":"828256236","supportEmail":"yourfriends@medium.com","fp":{"/icons/monogram-mask.svg":"https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg","/icons/favicon-dev-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-dev-editor.YKKRxBO8EMvIqhyCwIiJeQ.ico","/icons/favicon-hatch-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-hatch-editor.BuEyHIqlyh2s_XEk4Rl32Q.ico","/icons/favicon-medium-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium-editor.PiakrZWB7Yb80quUVQWM6g.ico"},"authBaseUrl":"https://medium.com","imageUploadSizeMb":25,"isAuthDomainRequest":true,"algoliaApiEndpoint":"https://MQ57UUUQZ2-dsn.algolia.net","algoliaAppId":"MQ57UUUQZ2","algoliaSearchOnlyApiKey":"394474ced050e3911ae2249ecc774921","iosAppStoreUrl":"https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8","iosAppLinkBaseUrl":"medium:","algoliaIndexPrefix":"medium_","androidPlayStoreUrl":"https://play.google.com/store/apps/details?id=com.medium.reader","googleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","androidPackage":"com.medium.reader","androidPlayStoreMarketScheme":"market://details?id=com.medium.reader","googleAuthUri":"https://accounts.google.com/o/oauth2/auth","androidScheme":"medium","layoutData":{"useDynamicScripts":false,"googleAnalyticsTrackingCode":"UA-24232453-2","jsShivUrl":"https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js","useDynamicCss":false,"faviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico","faviconImageId":"1*8I-HPL0bfoIzGied-dzOvA.png","fontSets":[{"id":8,"url":"https://glyph.medium.com/css/e/sr/latin/e/ssr/latin/e/ssb/latin/m2.css"},{"id":11,"url":"https://glyph.medium.com/css/m2.css"},{"id":9,"url":"https://glyph.medium.com/css/mkt.css"}],"editorFaviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium-editor.3Y6xpZ-0FSdWDnPM3hSBIA.ico","glyphUrl":"https://glyph.medium.com"},"authBaseUrlRev":"moc.muidem//:sptth","isDnt":true,"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","archiveUploadSizeMb":100,"paymentData":{"currencies":{"1":{"label":"US Dollar","external":"usd"}},"countries":{"1":{"label":"United States of America","external":"US"}},"accountTypes":{"1":{"label":"Individual","external":"individual"},"2":{"label":"Company","external":"company"}}},"previewConfig2":{"weightThreshold":1,"weightImageParagraph":0.05,"raiseImage":true,"enforceHeaderHierarchy":true,"isImageInsetRight":true},"isAmp":false,"iosScheme":"medium","isSwBoot":false,"facebook":{"key":"542599432471018","namespace":"medium-com","scope":{"default":["public_profile","email"],"connect":["public_profile","email"],"login":["public_profile","email"],"share":["public_profile","email"]}},"editorsPicksTopicId":"3985d2a191c5","popularOnMediumTopicId":"9d34e48ecf94","memberContentTopicId":"13d7efd82fb2","audioContentTopicId":"3792abbd134","brandedSequenceId":"7d337ddf1941","isDoNotAuth":false,"goldfinchUrl":"https://goldfinch.medium.com","buggle":{"url":"https://buggle.medium.com","videoUrl":"https://cdn-videos-1.medium.com","audioUrl":"https://cdn-audio-1.medium.com"},"referrerType":2,"isMeteredOut":false,"meterConfig":{"maxUnlockCount":3,"windowLength":"MONTHLY"},"partnerProgramEmail":"partnerprogram@medium.com","userResearchPrompts":[{"promptId":"lo_post_page_4","type":0,"url":"www.calendly.com"},{"promptId":"lo_home_page","type":1,"url":"www.calendly.com"},{"promptId":"lo_profile_page","type":2,"url":"www.calendly.com"}],"recaptchaKey":"6LdAokEUAAAAAC7seICd4vtC8chDb3jIXDQulyUJ","signinWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"countryCode":"FR","bypassMeter":false,"branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","paypal":{"clientMode":"production","oneYearGift":{"name":"Medium Membership (1 Year, Digital Gift Code)","description":"Unlimited access to the best and brightest stories on Medium. Gift codes can be redeemed at medium.com/redeem.","price":"50.00","currency":"USD","sku":"membership-gift-1-yr"}}}
// ]]></script><script charset="UTF-8" src="Managing%20my%20Home%20with%20Kubernetes,%20Traefik,%20and%20Raspberry%20Pi%E2%80%99s_files/main-base.js" async=""></script><script>// <![CDATA[
window["obvInit"]({"value":{"id":"d0330effea9a","versionId":"30dcdab435c3","creatorId":"da7f46287a8","creator":{"userId":"da7f46287a8","name":"Chris Evans","username":"evnsio","createdAt":1512114268594,"imageId":"0*coXb8TrcEf08KJ0d.jpg","backgroundImageId":"","bio":"Platform Team Lead @monzo","twitterScreenName":"evnsio","socialStats":{"userId":"da7f46287a8","usersFollowedCount":3,"usersFollowedByCount":46,"type":"SocialStats"},"social":{"userId":"lo_dnt_D9pyRGgrk388","targetUserId":"da7f46287a8","type":"Social"},"facebookAccountId":"","allowNotes":1,"mediumMemberAt":0,"isNsfw":false,"type":"User"},"homeCollectionId":"","title":"Managing my Home with Kubernetes, Traefik, and Raspberry Pi’s","detectedLanguage":"en","latestVersion":"30dcdab435c3","latestPublishedVersion":"30dcdab435c3","hasUnpublishedEdits":false,"latestRev":1901,"createdAt":1516046734758,"updatedAt":1529415469487,"acceptedAt":0,"firstPublishedAt":1516102646481,"latestPublishedAt":1516132862042,"vote":false,"experimentalCss":"","displayAuthor":"","content":{"subtitle":"I recently bought some Wifi enabled smart switches to allow me to control some table lamps at home. They’re great: super cheap in…","bodyModel":{"paragraphs":[{"name":"8426","type":3,"text":"Managing my Home with Kubernetes, Traefik, and Raspberry Pi’s","markups":[]},{"name":"c8e5","type":1,"text":"I recently bought some Wifi enabled smart switches to allow me to control some table lamps at home. They’re great: super cheap in comparison to some other offerings, simple to setup, and they work well with Google Assistant and and my Google Home. The problem is that they depend on an external server to work properly, and the reliability of that service has been pretty poor.","markups":[{"type":3,"start":23,"end":50,"href":"http://sonoff.itead.cc/en/products/sonoff/sonoff-basic","title":"","rel":"","anchorType":0},{"type":3,"start":365,"end":376,"href":"https://www.itead.cc/blog/explanation-on-service-disruption-on-eu-region","title":"","rel":"","anchorType":0}]},{"name":"5a30","type":1,"text":"Handily there’s an open source project providing custom firmware for these devices, so I decided to dust off my soldering iron and flash the devices (this warrants a whole article in itself — one for the future 😉). With the devices under my control I needed somewhere to run the software stack to manage them, so set to work on a couple of spare Raspberry Pi’s I had to hand.","markups":[{"type":3,"start":31,"end":38,"href":"https://github.com/arendst/Sonoff-Tasmota/","title":"","rel":"","anchorType":0}]},{"name":"1a1f","type":1,"text":"I had a few requirements:","markups":[]},{"name":"780b","type":9,"text":"I wanted to run a home automation platform with Android App support, and had chosen (semi-arbitrarily) Home Assistant.","markups":[]},{"name":"ed30","type":9,"text":"I wanted the web interface to be accessible outside of my home, so I could check and manage devices while away.","markups":[]},{"name":"9b66","type":9,"text":"I wanted my Google Home to be able to control the devices, which required me to have an external HTTPS endpoint.","markups":[]},{"name":"3749","type":9,"text":"I needed to manage dynamic DNS, since I don’t have a static IP.","markups":[]},{"name":"2a14","type":1,"text":"Whilst I could have run all these natively on a single Raspberry Pi, I decided instead to use Docker to keep things well isolated and easy to reason about. Moreover, I didn’t want to spend hours working over SSH so settled on Kubernetes for a more API driven deployment approach.","markups":[]},{"name":"d6f3","type":1,"text":"In this post, I’ll walk through the steps I took to setup the core platform. Specifically this includes:","markups":[]},{"name":"c30d","type":9,"text":"Setting up a master + single node Kubernetes cluster","markups":[]},{"name":"f00c","type":9,"text":"Deploying my DNS updater as a Kubernetes CronJob object.","markups":[]},{"name":"eccc","type":9,"text":"Deploying Traefik as a Kubernetes Ingress Controller, and configuring it to manage SSL with Let’s Encrypt.","markups":[]},{"name":"825f","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*5EE7y57XvUKdmfvA0pCkRQ.png","originalWidth":988,"originalHeight":610,"isFeatured":true}},{"name":"7e59","type":13,"text":"Setting up a Pi Kubernetes Cluster","markups":[]},{"name":"74a1","type":1,"text":"I claim no credit for this part, and simply copied the excellent guide written by Alex Ellis here. I pretty much followed it to the letter, using kubeadm to initialise a cluster on the master and then join in my single node.","markups":[{"type":10,"start":146,"end":153},{"type":3,"start":93,"end":97,"href":"https://gist.github.com/alexellis/fdbc90de7691a1b9edb545c17da2d975","title":"","rel":"","anchorType":0}]},{"name":"bc1b","type":8,"text":"$ kubectl get nodes","markups":[]},{"name":"395d","type":8,"text":"NAME         STATUS    ROLES     AGE       VERSION\nk8s-master   Ready     master    2d        v1.9.1\nk8s-node-1   Ready     \x3cnone\x3e    2d        v1.9.1","markups":[]},{"name":"ae13","type":1,"text":"Big thanks to Alex for sharing his guide 👏","markups":[]},{"name":"4330","type":13,"text":"DNS and Routing","markups":[]},{"name":"288c","type":1,"text":"To satisfy the need for external access and provide a stable endpoint for my dynamic IP, I needed something to periodically update a DNS record to the right address. I use Cloudflare to manage DNS for my website, so decided to use a subdomain for things running at home.","markups":[]},{"name":"cc20","type":1,"text":"I wrote a simple (read hacky) bash script to do the Cloudflare update, deployed it into Kubernetes as a ConfigMap, and mounted it as a volume in a CronJob object set to run every 15 mins:","markups":[{"type":10,"start":104,"end":113},{"type":10,"start":147,"end":154}]},{"name":"71c0","type":8,"text":"apiVersion: batch/v1beta1\nkind: CronJob\nmetadata:\n  name: dns-update\n  namespace: k8s-home\nspec:\n  schedule: \"*/15 * * * *\"\n  concurrencyPolicy: Forbid\n  jobTemplate:\n    spec:\n      template:\n        spec:\n          containers:\n          - name: dns-update\n            image: evns/rpi-utilities\n            command: [ \"/bin/sh\", \"-c\", \"chmod +x /scripts/update.sh && /scripts/update.sh\" ]\n            env:\n            - name: RECORD_NAME\n              valueFrom:\n                secretKeyRef:\n                  name: cloudflare\n                  key: record_name\n            - name: API_KEY\n              valueFrom:\n                secretKeyRef:\n                  name: cloudflare\n                  key: api_key\n            ...\n            volumeMounts:\n            - name: config-volume\n              mountPath: /scripts\n          volumes:\n          - name: config-volume\n            configMap:\n              name: update-script","markups":[]},{"name":"3f9e","type":1,"text":"At this point I had a DNS entry *.home.evns.io pointed at my dynamic public IP 👌","markups":[{"type":10,"start":32,"end":46}]},{"name":"3df7","type":1,"text":"To pave the way for running web applications, I knew I’d need to open at least ports 80 and 443 on my router’s firewall, and since the destination would be a container running on my Kubernetes node I configured the ports to forward to that IP. Obviously, at this stage there was nothing running there so I wasn’t expecting any kind of response.","markups":[]},{"name":"f0cc","type":13,"text":"Traefik and Let’s Encrypt","markups":[]},{"name":"7236","type":1,"text":"With a functioning cluster, and the networking setup complete, the next task was to deploy a reverse proxy to manage the application routing. In Kubernetes we can deploy an Ingress Controller to achieve this. An Ingress Controller is an implementation of a reverse proxy which listens for changes to KubernetesIngress resources and updates it’s configuration accordingly. I’ve previously used Nginx for this purpose, but having heard good things about Traefik decided to give it a whirl.","markups":[{"type":10,"start":310,"end":317},{"type":3,"start":173,"end":191,"href":"https://medium.com/@cashisclay/kubernetes-ingress-82aa960f658e","title":"","rel":"","anchorType":0}]},{"name":"2356","type":1,"text":"Traefik provide detailed instructions to get their implementation running, but I had to customise it slightly to get things working with my setup.","markups":[{"type":3,"start":25,"end":37,"href":"https://docs.traefik.io/user-guide/kubernetes/","title":"","rel":"","anchorType":0}]},{"name":"c423","type":1,"text":"First, since I wanted all communication over HTTPS, I modified the config to force anything on HTTP over to the secure entrypoint. This was as simple as adding the following to the config file:","markups":[]},{"name":"6bff","type":8,"text":"# Force HTTPS\n[entryPoints]\n  [entryPoints.http]\n  address = \":80\"\n    [entryPoints.http.redirect]\n    entryPoint = \"https\"\n  [entryPoints.https]\n  address = \":443\"\n    [entryPoints.https.tls]","markups":[]},{"name":"4f09","type":1,"text":"To support the HTTPS endpoints, I also needed to configure Let’s Encrypt to enable it to automatically fetch certificates. Having Let’s Encrypt as a built capability is one of the areas where Traefik excels. In previous Kubernetes configurations I’ve had to deploy a separate application like kube-lego to handle the certificate generation, so having it built in is a big positive. I used Cloudflare as the DNS provider which configures Traefik to use DNS records for domain validation.","markups":[{"type":3,"start":293,"end":302,"href":"https://github.com/jetstack/kube-lego","title":"","rel":"","anchorType":0}]},{"name":"ac50","type":8,"text":"# Let's encrypt configuration\n[acme]\n  email=\"\x3cmy-email\x3e\"\n  storage=\"/etc/traefik/acme.json\"\n  entryPoint=\"https\"\n  acmeLogging=true\n  onDemand=true\n  onHostRule=true\n  dnsProvider=\"cloudflare\"","markups":[]},{"name":"8f13","type":1,"text":"Next I updated the Deployment to use the new config, and also to store the Let’s Encrypt state on the host to ensure persistence in the event of the container being updated. One issue I had here was that the file created by Traefik had the wrong permissions set; Kubernetes creates the file on the host with 755 which Traefik deems overly permissive, expecting only 600. In the interest of getting things working, I’ve deferred the investigation into this and simply changed the permission manually on the host. The final change was to provide the Cloudflare credentials to enable control of my DNS zone.","markups":[{"type":10,"start":19,"end":29}]},{"name":"0441","type":8,"text":"kind: Deployment\napiVersion: extensions/v1beta1\nmetadata:\n  name: traefik-ingress-controller\n  namespace: kube-system\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      k8s-app: traefik-ingress-lb\n  template:\n    metadata:\n      labels:\n        name: traefik-ingress-lb\n    spec:\n      serviceAccountName: traefik-ingress-controller\n      terminationGracePeriodSeconds: 60\n      containers:\n      - image: traefik:v1.5\n        name: traefik-ingress-lb\n        env:\n          - name: CLOUDFLARE_EMAIL\n            valueFrom:\n              secretKeyRef:\n                name: cloudflare\n                key: email\n          - name: CLOUDFLARE_API_KEY\n            valueFrom:\n              secretKeyRef:\n                name: cloudflare\n                key: api_key\n        volumeMounts:\n          - mountPath: \"/config\"\n            name: \"config\"\n          - mountPath: \"/etc/traefik/acme.json\"\n            name: \"acme\"\n        args:\n          - --configfile=/config/traefik.toml\n      volumes:\n        - name: config\n          configMap:\n            name: traefik-config\n        - name: acme\n          hostPath:\n            type: FileOrCreate\n            path: /etc/traefik/acme.json","markups":[]},{"name":"2852","type":1,"text":"The final change was to edit the Traefik Service to allow external access into the cluster. By default it exposes ports 80 and 443 to other services in the cluster, as is the nature with a service of type ClusterIP. In a cloud installation it’s common to change to the service type to LoadBalancer, which would provision an external load balancer with a stable IP/DNS address, but since I have no load balancers in my Pi setup and only one node, I instead updated the service definition to include an externalIP. This essentially binds ports 80 and 443 on the host interface to ensure all traffic is routed to Pods running Traefik.","markups":[{"type":10,"start":41,"end":48},{"type":10,"start":205,"end":214},{"type":10,"start":285,"end":297}]},{"name":"8595","type":8,"text":"kind: Service\napiVersion: v1\nmetadata:\n  name: traefik-ingress-service\n  namespace: kube-system\nspec:\n  selector:\n    k8s-app: traefik-ingress-lb\n  ports:\n    - protocol: TCP\n      port: 80\n      name: http\n    - protocol: TCP\n      port: 443\n      name: https\n  externalIPs:\n    - 192.168.0.101 # This is the node address","markups":[]},{"name":"0ef5","type":1,"text":"With all this in place, I deployed a Service and Ingress for the Traefik dashboard, and sat back while it automatically configured the routing and SSL certs 😎 The result is a secure site accessible on the internet as can be seen here 👇","markups":[{"type":10,"start":37,"end":44},{"type":10,"start":49,"end":56}]},{"name":"ee4b","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*X9xupOkHICAThl9R2gPmzw.png","originalWidth":1108,"originalHeight":627}},{"name":"249a","type":13,"text":"PiVPN","markups":[]},{"name":"2d6f","type":1,"text":"Whilst not an original requirement, I also decided to deploy a VPN solution so could manage everything whilst away from home. I used PiVPN to deploy an OpenVPN server on the master. The instructions here provided everything I needed to get it working.","markups":[{"type":3,"start":199,"end":203,"href":"http://www.pivpn.io/","title":"","rel":"","anchorType":0}]},{"name":"40e8","type":13,"text":"Bringing it all Together","markups":[]},{"name":"c35e","type":1,"text":"My home setup now looks roughly like this:","markups":[]},{"name":"533f","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*6M9G1DeawV-ctdbduVaZNg.png","originalWidth":426,"originalHeight":461}},{"name":"5e63","type":1,"text":"I have a cluster which I can manage from anywhere, and the ability to run and expose applications over HTTPS using only Kubernetes resources. Is it over engineered for a home solution? Probably. But I’ve now got something super flexible which I can use to for running apps in my home, and more importantly I got to play with some interesting tech along the way.","markups":[]},{"name":"d1dc","type":13,"text":"What’s next?","markups":[]},{"name":"2910","type":1,"text":"The astute among you will notice I haven’t discussed the Home Automation side of things. I’ll post something on this over the next few weeks.","markups":[]}],"sections":[{"name":"96bf","startIndex":0},{"name":"0b8b","startIndex":14},{"name":"0d9d","startIndex":40}]},"postDisplay":{"coverless":true}},"virtuals":{"allowNotes":true,"previewImage":{"imageId":"1*5EE7y57XvUKdmfvA0pCkRQ.png","filter":"","backgroundSize":"","originalWidth":988,"originalHeight":610,"strategy":"resample","height":0,"width":0},"wordCount":1425,"imageCount":3,"readingTime":5.9273584905660375,"subtitle":"I recently bought some Wifi enabled smart switches to allow me to control some table lamps at home. They’re great: super cheap in…","usersBySocialRecommends":[],"noIndex":false,"recommends":43,"socialRecommends":[],"isBookmarked":false,"tags":[{"slug":"kubernetes","name":"Kubernetes","postCount":6578,"metadata":{"postCount":6578,"coverImage":{"id":"1*nmBlCPUoiS6IBl5FJ8Qffw.jpeg","originalWidth":1280,"originalHeight":720,"isFeatured":true}},"type":"Tag"},{"slug":"traefik","name":"Traefik","postCount":87,"metadata":{"postCount":87,"coverImage":{"id":"1*pOq8yX3TmoRhBTDQXPUS6g.png","originalWidth":1080,"originalHeight":415,"isFeatured":true}},"type":"Tag"},{"slug":"raspberry-pi","name":"Raspberry Pi","postCount":4800,"metadata":{"postCount":4800,"coverImage":{"id":"0*5UylFacSYYf5-bcJ","originalWidth":1105,"originalHeight":829,"isFeatured":true}},"type":"Tag"},{"slug":"home-automation","name":"Home Automation","postCount":783,"metadata":{"postCount":783,"coverImage":{"id":"0*5UylFacSYYf5-bcJ","originalWidth":1105,"originalHeight":829,"isFeatured":true}},"type":"Tag"},{"slug":"smart-home","name":"Smart Home","postCount":4076,"metadata":{"postCount":4076,"coverImage":{"id":"0*5UylFacSYYf5-bcJ","originalWidth":1105,"originalHeight":829,"isFeatured":true}},"type":"Tag"}],"socialRecommendsCount":0,"responsesCreatedCount":1,"links":{"entries":[{"url":"https://github.com/arendst/Sonoff-Tasmota/","alts":[],"httpStatus":200},{"url":"https://github.com/jetstack/kube-lego","alts":[],"httpStatus":200},{"url":"http://sonoff.itead.cc/en/products/sonoff/sonoff-basic","alts":[],"httpStatus":200},{"url":"https://docs.traefik.io/user-guide/kubernetes/","alts":[],"httpStatus":200},{"url":"https://www.itead.cc/blog/explanation-on-service-disruption-on-eu-region","alts":[],"httpStatus":200},{"url":"https://medium.com/@cashisclay/kubernetes-ingress-82aa960f658e","alts":[{"type":2,"url":"medium://p/82aa960f658e"},{"type":3,"url":"medium://p/82aa960f658e"}],"httpStatus":200},{"url":"https://gist.github.com/alexellis/fdbc90de7691a1b9edb545c17da2d975","alts":[],"httpStatus":200},{"url":"http://www.pivpn.io/","alts":[],"httpStatus":200}],"version":"0.3","generatedAt":1516132862794},"isLockedPreviewOnly":false,"takeoverId":"","metaDescription":"","totalClapCount":155,"sectionCount":3,"readingList":0,"topics":[]},"coverless":true,"slug":"managing-my-home-with-kubernetes-traefik-and-raspberry-pis","translationSourcePostId":"","translationSourceCreatorId":"","isApprovedTranslation":false,"inResponseToPostId":"","inResponseToRemovedAt":0,"isTitleSynthesized":true,"allowResponses":true,"importedUrl":"","importedPublishedAt":0,"visibility":0,"uniqueSlug":"managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a","previewContent":{"bodyModel":{"paragraphs":[{"name":"previewImage","type":4,"text":"","layout":10,"metadata":{"id":"1*5EE7y57XvUKdmfvA0pCkRQ.png","originalWidth":988,"originalHeight":610,"isFeatured":true}},{"name":"8426","type":3,"text":"Managing my Home with Kubernetes, Traefik, and Raspberry Pi’s","markups":[],"alignment":1}],"sections":[{"startIndex":0}]},"isFullContent":false,"subtitle":"I recently bought some Wifi enabled smart switches to allow me to control some table lamps at home. They’re great: super cheap in…"},"license":0,"inResponseToMediaResourceId":"","canonicalUrl":"https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a","approvedHomeCollectionId":"","newsletterId":"","webCanonicalUrl":"https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a","mediumUrl":"https://medium.com/@evnsio/managing-my-home-with-kubernetes-traefik-and-raspberry-pis-d0330effea9a","migrationId":"","notifyFollowers":true,"notifyTwitter":true,"notifyFacebook":false,"responseHiddenOnParentPostAt":0,"isSeries":false,"isSubscriptionLocked":false,"seriesLastAppendedAt":0,"audioVersionDurationSec":0,"sequenceId":"","isNsfw":false,"isEligibleForRevenue":false,"isBlockedFromHightower":false,"deletedAt":0,"lockedPostSource":0,"hightowerMinimumGuaranteeStartsAt":0,"hightowerMinimumGuaranteeEndsAt":0,"featureLockRequestAcceptedAt":0,"mongerRequestType":1,"layerCake":0,"socialTitle":"","socialDek":"","editorialPreviewTitle":"","editorialPreviewDek":"","curationEligibleAt":0,"type":"Post"},"mentionedUsers":[],"collaborators":[],"collectionUserRelations":[],"mode":null,"references":{"User":{"da7f46287a8":{"userId":"da7f46287a8","name":"Chris Evans","username":"evnsio","createdAt":1512114268594,"imageId":"0*coXb8TrcEf08KJ0d.jpg","backgroundImageId":"","bio":"Platform Team Lead @monzo","twitterScreenName":"evnsio","socialStats":{"userId":"da7f46287a8","usersFollowedCount":3,"usersFollowedByCount":46,"type":"SocialStats"},"social":{"userId":"lo_dnt_D9pyRGgrk388","targetUserId":"da7f46287a8","type":"Social"},"facebookAccountId":"","allowNotes":1,"mediumMemberAt":0,"isNsfw":false,"type":"User"}},"Social":{"da7f46287a8":{"userId":"lo_dnt_D9pyRGgrk388","targetUserId":"da7f46287a8","type":"Social"}},"SocialStats":{"da7f46287a8":{"userId":"da7f46287a8","usersFollowedCount":3,"usersFollowedByCount":46,"type":"SocialStats"}}}})
// ]]></script><script type="text/javascript">(function(b,r,a,n,c,h,_,s,d,k){if(!b[n]||!b[n]._q){for(;s<_.length;)c(h,_[s++]);d=r.createElement(a);d.async=1;d.src="https://cdn.branch.io/branch-latest.min.js";k=r.getElementsByTagName(a)[0];k.parentNode.insertBefore(d,k);b[n]=h}})(window,document,"script","branch",function(b,r){b[r]=function(){b._q.push([r,arguments])}},{_q:[],_v:1},"addListener applyCode autoAppIndex banner closeBanner closeJourney creditHistory credits data deepview deepviewCta first getCode init link logout redeem referrals removeListener sendSMS setBranchViewData setIdentity track validateCode trackCommerceEvent logEvent".split(" "), 0); branch.init('key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm', {'no_journeys': true, 'disable_exit_animation': true, 'disable_entry_animation': true}, function(err, data) {});</script></body></html>